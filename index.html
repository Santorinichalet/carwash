<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠ â€” Ø³Ø¹Ø±Ø§Øª/Ø¨Ø±ÙˆØªÙŠÙ† + Ø¬Ø¯ÙˆÙ„ ØªÙ…Ø§Ø±ÙŠÙ†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@500;700;800&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0d1513;
      --card:#12201d;
      --card2:#0f1b18;
      --text:#edf7f2;
      --muted:#a8c1b7;
      --line:rgba(255,255,255,.08);
      --accent:#5fcfa7;
      --good:#4ee0b0;
      --warn:#f6c36f;
      --bad:#ff7c86;
      --shadow: 0 14px 34px rgba(0,0,0,.34);
      --radius:18px;
      --font: "Tajawal", system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(122,167,255,.18), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(88,214,141,.12), transparent 55%),
        linear-gradient(180deg, #070b14, var(--bg));
      min-height:100vh;
    }
    header{
      padding:18px 14px 6px;
      position:sticky; top:0;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(7,11,20,.85), rgba(7,11,20,.55));
      border-bottom: 1px solid var(--line);
      z-index:5;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:14px;}
    h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.2px}
    .sub{margin:6px 0 0;color:var(--muted);font-size:12.5px}
    .grid{display:grid;gap:12px}
    @media(min-width:980px){ .grid{grid-template-columns: 420px 1fr;} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
      border-bottom:1px solid var(--line);
    }
    .card .hd h2{margin:0;font-size:14.5px}
    .card .bd{padding:14px}
    .row2{display:grid;gap:10px}
    @media(min-width:520px){ .row2{grid-template-columns:1fr 1fr;} }
    label{display:block;font-size:12.5px;color:var(--muted);margin-bottom:6px}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(17,27,46,.65);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{border-color: rgba(122,167,255,.55); box-shadow: 0 0 0 3px rgba(122,167,255,.15);}
    textarea{min-height:92px;resize:vertical}
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      color: #071022;
      background: linear-gradient(180deg, var(--accent), #5f8dff);
      box-shadow: 0 10px 20px rgba(122,167,255,.18);
    }
    button.secondary{
      color:var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      box-shadow:none;
    }
    button.danger{
      color: #200708;
      background: linear-gradient(180deg, #ff8787, #ff5f5f);
      box-shadow: 0 10px 20px rgba(255,107,107,.18);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background: rgba(17,27,46,.55);
      color:var(--muted);
      font-size:12.5px;
    }
    .kpis{display:grid;gap:10px}
    @media(min-width:520px){ .kpis{grid-template-columns:1fr 1fr;} }
    .kpi{
      padding:12px;border-radius:14px;border:1px solid var(--line);
      background: rgba(17,27,46,.45);
    }
    .kpi .t{color:var(--muted);font-size:12.5px;margin-bottom:6px}
    .kpi .v{font-size:20px;font-weight:900}
    .kpi .s{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.5}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      background: rgba(17,27,46,.45);
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      font-size:12.5px;
    }
    .tab.active{
      color: var(--text);
      border-color: rgba(122,167,255,.45);
      background: rgba(122,167,255,.12);
    }
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(17,27,46,.35);
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      text-align:right;
      font-size:12.8px;
      vertical-align:top;
    }
    .table th{color:var(--muted);font-weight:800;background: rgba(255,255,255,.03);}
    .table tr:last-child td{border-bottom:0}
    .muted{color:var(--muted)}
    .hint{font-size:12.5px;color:var(--muted);line-height:1.6;margin-top:8px}
    .split{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .badge{
      font-size:11.5px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      white-space:nowrap;
    }
    .link{
      color: var(--accent);
      text-decoration: none;
      font-weight:800;
    }
    .link:hover{text-decoration:underline}
    .small{font-size:12px}
    .footer{padding:10px 14px 24px;color:var(--muted);font-size:12px;line-height:1.6}
    .hr{height:1px;background:var(--line);margin:12px 0}
  
    /* Wellness Green theme overrides */
    body{
      background:
        radial-gradient(1000px 450px at 8% 0%, rgba(95,207,167,.18), transparent 60%),
        radial-gradient(800px 420px at 90% 10%, rgba(122,167,255,.10), transparent 55%),
        linear-gradient(180deg, #09100f, #0d1513) !important;
      color: var(--text);
    }
    header{
      background: linear-gradient(180deg, rgba(9,16,15,.86), rgba(9,16,15,.58));
      border-bottom:1px solid var(--line);
    }
    .card{
      backdrop-filter: blur(10px);
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(95,207,167,.28);
      box-shadow: 0 18px 44px rgba(0,0,0,.42);
    }
    .kpi{
      background: rgba(95,207,167,.05);
      border:1px solid var(--line);
      position:relative;
    }
    .kpi::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 55%);
      pointer-events:none;
      border-radius: inherit;
    }
    input, select, textarea{
      background: rgba(255,255,255,.03) !important;
      border-color: var(--line);
      color: var(--text);
      font-size:16px;
      font-family: var(--font);
    }
    input::placeholder, textarea::placeholder{ color: color-mix(in srgb, var(--muted) 80%, white 0%); }
    button{
      background: linear-gradient(180deg, var(--accent), #3dbb92);
      box-shadow: 0 10px 24px rgba(61,187,146,.25);
      transition: transform .15s ease, box-shadow .2s ease, opacity .2s ease;
    }
    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(0); }

    /* Dropdown visibility (mobile + dark) */
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      padding-inline-start: 12px;
      padding-inline-end: 40px;
      background-image:
        linear-gradient(45deg, transparent 50%, var(--muted) 50%),
        linear-gradient(135deg, var(--muted) 50%, transparent 50%);
      background-position: left 14px center, left 8px center;
      background-size: 6px 6px, 6px 6px;
      background-repeat:no-repeat;
      font-weight:700;
      text-overflow: ellipsis;
    }
    select option, select optgroup{
      background:#13231f;
      color:#edf7f2;
      font-family: var(--font);
      font-weight:600;
    }
    select:focus{
      border-color: rgba(95,207,167,.55) !important;
      box-shadow: 0 0 0 3px rgba(95,207,167,.14) !important;
    }

    /* Auth + modal + profile UX */
    [hidden]{ display:none !important; }
    .topUserBar{
      margin-top:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .identityPill{ display:inline-flex; align-items:center; gap:8px; }
    .avatar{
      width:26px;height:26px;border-radius:50%;
      display:inline-flex;align-items:center;justify-content:center;
      background: rgba(95,207,167,.18);
      border:1px solid var(--line);
      font-weight:900;
      color: var(--text);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .avatar img{ width:100%;height:100%;object-fit:cover;display:block; }
    .topUserBtns{ margin-top:0; }
    .topUserBtns button{
      min-height:36px;
      padding:8px 10px;
      font-size:13px;
    }
    .authCard{ max-width:560px; margin:2px auto; }
    .authBtns button{ flex:1 1 180px; }
    #authMsg, #accountMsg{
      margin-top:10px;
      width:100%;
      justify-content:center;
      text-align:center;
      min-height:36px;
    }
    #profileLockHint{
      margin:2px 0 10px;
      border:1px dashed var(--line);
      border-radius:12px;
      padding:10px 12px;
      background: rgba(95,207,167,.05);
    }
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      z-index: 999;
    }
    .modalCard{ width:min(760px, 100%); }
    .modalCard .hd{ position:sticky; top:0; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); }
    .modalClose{ background: rgba(255,255,255,.06); border:1px solid var(--line); color:var(--text); box-shadow:none; }
    @media(max-width:640px){
      .topUserBar{ align-items:stretch; }
      .topUserBar .pill{ width:100%; justify-content:center; }
      .topUserBtns{ width:100%; }
      .topUserBtns button{ flex:1 1 calc(50% - 4px); }
      .authBtns button{ flex-basis:100%; }
      .modal{ align-items:stretch; }
      .modalCard{ height:100%; overflow:auto; }
    }

    /* Better mobile experience */
    html, body{ max-width:100%; overflow-x:hidden; }
    button{ min-height:42px; }
    .tab{ min-height:38px; display:inline-flex; align-items:center; justify-content:center; }
    @media (max-width: 860px){
      header{ padding: 12px 10px 6px; }
      .wrap{ padding: 10px; }
      h1{ font-size: 16px; line-height: 1.35; }
      .sub{ font-size: 12px; line-height: 1.5; }
      .card .hd{ padding: 12px 12px 8px; }
      .card .bd{ padding: 12px; }
      .row2{ gap: 8px; }
      .btns{ gap: 8px; }
      .btns button{ flex: 1 1 calc(50% - 4px); }
      .btns button.secondary:last-child,
      .btns button.danger:last-child{ flex-basis: 100%; }
      .tabs{
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        padding-bottom: 2px;
      }
      .tab{ white-space: nowrap; flex: 0 0 auto; }
      .table{
        display: block;
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border-radius: 12px;
      }
      .table thead, .table tbody, .table tr{ width: max-content; min-width: 100%; }
      .table th, .table td{ white-space: nowrap; font-size: 12px; padding: 9px 8px; }
      .split{ gap: 6px; }
      .badge{ font-size: 11px; }
    }
    @media (max-width: 480px){
      .btns button{ flex-basis: 100%; }
      .kpi .v{ font-size: 18px; }
      label{ font-size: 12px; }
      input, select, textarea{ border-radius: 10px; }
      textarea{ min-height: 84px; }
    }


    /* ===== Light Cards Home (override) ===== */
    :root{
      --bg:#f3f7fb !important;
      --card:#ffffff !important;
      --card2:#f7fbff !important;
      --text:#182235 !important;
      --muted:#6c7a95 !important;
      --line:rgba(25,40,70,.10) !important;
      --accent:#39b68a !important;
      --good:#25b67b !important;
      --warn:#f0b04f !important;
      --bad:#ef5f6c !important;
      --shadow:0 10px 30px rgba(31,42,68,.08) !important;
      --radius:18px !important;
      --font:"Tajawal", system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif !important;
    }
    body{
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(79,140,255,.10), transparent 60%),
        radial-gradient(700px 350px at 90% 10%, rgba(57,182,138,.09), transparent 55%),
        linear-gradient(180deg, #f8fbff, #eef3fa) !important;
      color:var(--text) !important;
    }
    header{
      background: rgba(255,255,255,.78) !important;
      border-bottom:1px solid var(--line) !important;
      backdrop-filter: blur(10px);
    }
    h1{ font-family:"Alexandria", var(--font); color:#17243a; }
    .sub{ color:var(--muted) !important; }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.97), rgba(255,255,255,.93)) !important;
      border:1px solid var(--line) !important;
      box-shadow: var(--shadow) !important;
    }
    .card .hd{ background: linear-gradient(180deg, rgba(79,140,255,.05), transparent) !important; }
    .kpi{ background:#f8fbff !important; }
    .pill,.badge,.tab{
      background: rgba(79,140,255,.06) !important;
      color: var(--muted) !important;
      border-color: var(--line) !important;
    }
    .tab.active{
      background: rgba(79,140,255,.12) !important;
      border-color: rgba(79,140,255,.28) !important;
      color: var(--text) !important;
    }
    input,select,textarea{
      background:#fff !important;
      color:var(--text) !important;
      border:1px solid var(--line) !important;
      font-family: var(--font) !important;
    }
    input::placeholder, textarea::placeholder{ color:#90a0bb !important; }
    select{
      background-image:
        linear-gradient(45deg, transparent 50%, #7b89a2 50%),
        linear-gradient(135deg, #7b89a2 50%, transparent 50%) !important;
    }
    select option, select optgroup{ background:#fff !important; color:#182235 !important; }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(79,140,255,.45) !important;
      box-shadow: 0 0 0 3px rgba(79,140,255,.12) !important;
    }
    button{
      color:#fff !important;
      background: linear-gradient(180deg, #4f8cff, #3f7ef6) !important;
      box-shadow: 0 10px 20px rgba(79,140,255,.20) !important;
      border:0 !important;
    }
    button.secondary{
      color:#1c2b46 !important;
      background: #fff !important;
      border:1px solid var(--line) !important;
      box-shadow:none !important;
    }
    button.danger{
      color:#fff !important;
      background: linear-gradient(180deg, #ef6d78, #e45561) !important;
      box-shadow: 0 10px 20px rgba(239,95,108,.18) !important;
    }
    .table{ background:#fff !important; }
    .table th{ background:#f7fbff !important; }
    .table tbody tr:nth-child(even){ background: rgba(79,140,255,.03); }
    .link{ color:#3f7ef6 !important; }

    /* Home cards layout */
    #appMain.cardsHomeEnabled{ display:block !important; max-width:1100px; }
    #homeHub{ margin-bottom:12px; }
    .welcomeHero{
      margin-bottom:12px;
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.97), rgba(246,251,255,.96));
      box-shadow: var(--shadow);
      padding:14px;
    }
    .welcomeHero h2{
      margin:0;
      font-family:"Alexandria", var(--font);
      font-size:20px;
      color:#17243a;
    }
    .welcomeHero p{ margin:6px 0 0; color:var(--muted); font-size:13px; }
    .cardsGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    .homeCard{
      border:1px solid var(--line);
      border-radius:18px;
      background:linear-gradient(180deg, #ffffff, #f9fbff);
      box-shadow: var(--shadow);
      padding:14px;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      text-align:right;
      position:relative;
      overflow:hidden;
    }
    .homeCard::before{
      content:"";
      position:absolute;
      inset:0 0 auto 0;
      height:4px;
      background:linear-gradient(90deg, rgba(79,140,255,.45), rgba(57,182,138,.45));
      opacity:.8;
    }
    .homeCard:hover{ transform: translateY(-2px); border-color: rgba(79,140,255,.22); }
    .homeCard .icon{
      width:44px;height:44px;border-radius:14px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid rgba(25,40,70,.10);
      box-shadow: 0 8px 18px rgba(31,42,68,.07);
      color:#23314f;
      font-size:21px;font-weight:700;
      margin-bottom:10px;
      background:#fff;
    }
    .homeCard h3{ margin:0 0 4px; font-family:"Alexandria", var(--font); font-size:14px; color:#17243a; }
    .homeCard .desc{ color:var(--muted); font-size:12.5px; line-height:1.5; min-height:36px; }
    .homeCard .quick{ margin-top:8px; font-weight:800; color:#213252; font-size:13px; }
    .homeCard.card-daily{
      background: linear-gradient(180deg, #ffffff, #f7fbff);
    }
    .homeCard.card-daily::before{ background: linear-gradient(90deg, rgba(79,140,255,.55), rgba(123,169,255,.35)); }
    .homeCard.card-daily .icon{ background: linear-gradient(180deg, #eef5ff, #f8fbff); }
    .homeCard.card-diet{
      background: linear-gradient(180deg, #ffffff, #f8fffb);
    }
    .homeCard.card-diet::before{ background: linear-gradient(90deg, rgba(57,182,138,.55), rgba(95,207,167,.35)); }
    .homeCard.card-diet .icon{ background: linear-gradient(180deg, #effff8, #fbfffd); }
    .homeCard.card-workout{
      background: linear-gradient(180deg, #ffffff, #fffaf4);
    }
    .homeCard.card-workout::before{ background: linear-gradient(90deg, rgba(240,176,79,.6), rgba(255,141,98,.35)); }
    .homeCard.card-workout .icon{ background: linear-gradient(180deg, #fff7e9, #fffdf8); }

    .kpi.kpi-soft-blue{ background:#f5f9ff !important; }
    .kpi.kpi-soft-green{ background:#f4fffb !important; }
    .kpi.kpi-soft-peach{ background:#fff9ef !important; }
    .kpi.kpi-soft-violet{ background:#f8f6ff !important; }

    #detailHeader{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      margin-bottom:10px;
    }
    #detailTitle{ font-family:"Alexandria", var(--font); font-size:15px; font-weight:700; color:#17243a; }
    #detailBackBtn{ min-height:38px; }
    #detailViews > *[hidden]{ display:none !important; }

    .dietCard .dietTop{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
    .dietMini{ background:#f8fbff; border:1px solid var(--line); border-radius:14px; padding:12px; }
    .dietMini .t{ color:var(--muted); font-size:12px; margin-bottom:6px; }
    .dietMini .v{ font-weight:900; font-size:18px; color:#1f2a44; }
    .dietMini .s{ color:var(--muted); font-size:12px; margin-top:4px; }
    .dietPlanBox{ margin-top:10px; border:1px solid var(--line); border-radius:14px; background:#fff; padding:12px; line-height:1.75; color:#1d2a43; }
    .foodPickerWrap{ margin-top:12px; border:1px solid var(--line); border-radius:16px; background:linear-gradient(180deg, #ffffff, #f8fffb); padding:12px; }
    .foodPickerHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .foodPickerHead .title{ font-weight:900; color:#17243a; font-family:"Alexandria", var(--font); font-size:14px; }
    .foodPickerHead .subtxt{ color:var(--muted); font-size:12px; margin-top:4px; }
    .foodPickerToggle{ min-height:40px; white-space:nowrap; }
    .foodPickerPanel{ margin-top:10px; }
    .foodSearch label{ display:block; margin-bottom:6px; font-size:12px; color:var(--muted); }
    .foodGroups{ display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:10px; margin-top:10px; }
    .foodGroup{ border:1px solid var(--line); border-radius:14px; background:#fff; padding:10px; }
    .foodGroup h4{ margin:0 0 8px; font-size:13px; font-weight:900; color:#1c2b45; }
    .foodChips{ display:grid; gap:8px; }
    .foodChip{
      width:100%;
      border:1.5px solid #7fa8f1;
      background:linear-gradient(180deg, #6ea4ff, #4a84f6);
      color:#132238;
      min-height:64px; padding:10px 12px; border-radius:14px;
      font:inherit; font-size:13px; font-weight:700; cursor:pointer;
      transition:transform .15s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
      display:flex; flex-direction:column; align-items:flex-start; justify-content:center;
      text-align:right; line-height:1.45;
      box-shadow:0 8px 18px rgba(74,132,246,.16);
    }
    .foodChipName{ font-weight:900; color:#0f172a; }
    .foodChipMeta{ font-size:12px; color:#ffffff; margin-top:4px; }
    .foodChip:hover{ transform:translateY(-1px); border-color:#5d8ef0; box-shadow:0 10px 22px rgba(74,132,246,.22); }
    .foodChip.active:hover{ border-color:#e11d48 !important; }
    .foodChip.active{
      background:linear-gradient(180deg, #6ea4ff, #4a84f6);
      border:2.5px solid #e11d48 !important;
      outline:3px solid rgba(225,29,72,.18);
      outline-offset:0;
      color:#132238;
      box-shadow:0 0 0 3px rgba(225,29,72,.24), inset 0 0 0 1px rgba(255,255,255,.22), 0 10px 22px rgba(74,132,246,.2);
    }
    .foodChip.active .foodChipName{ color:#0f172a; }
    .foodChip.active .foodChipMeta{ color:#ffffff; }
    .foodPickerActions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; }
    .foodSummary{
      margin-top:10px; border:1px dashed #cfe0ee; border-radius:14px;
      background:#fbfdff; padding:10px 12px; color:#294161; line-height:1.7;
    }
    .foodSummary strong{ color:#11233e; }
    .dietChoicePlan{
      margin-top:10px; border:1px solid #dfe7f0; border-radius:14px;
      background:linear-gradient(180deg, #ffffff, #fbfffd); padding:12px;
      line-height:1.8; color:#1d2a43;
    }
    .dietChoicePlan .muted{ color:var(--muted); }


    @media(max-width:860px){
      .cardsGrid{ grid-template-columns:1fr; }
      .welcomeHero h2{ font-size:18px; }
      .dietCard .dietTop{ grid-template-columns:1fr; }
      #detailHeader{ flex-wrap:wrap; }
      #detailBackBtn{ width:100%; }
      .foodGroups{ grid-template-columns:1fr; }
      .foodPickerHead{ flex-direction:column; align-items:stretch; }
      .foodPickerToggle{ width:100%; }
      .foodPickerActions button{ width:100%; }
    }
    

  
    /* ===== UX patch: one-line selects + nicer popups ===== */
    /* Keep selected values in one line */
    select,
    .table th,
    .table td{
      white-space: nowrap;
    }
    select{
      display:block;
      min-height:46px;
      line-height:1.2;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    /* Long exercise names look better with slightly smaller size */
    #exerciseSelect{ font-size:15px !important; font-weight:700; }
    #daySelect, #libSplitFilter, #activity, #goal, #cardioPref, #sex{
      font-weight:700;
    }

    /* Better popup/modal visual style */
    .modal{
      background: rgba(15, 23, 42, .32) !important;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding:14px;
    }
    .modalCard{
      width:min(760px, 100%);
      border-radius:22px !important;
      border:1px solid var(--line) !important;
      background: linear-gradient(180deg, #ffffff, #f7fbff) !important;
      box-shadow: 0 24px 60px rgba(20, 35, 70, .18) !important;
      overflow:hidden;
      animation: modalPopIn .18s ease;
    }
    .modalCard .hd{
      background: linear-gradient(180deg, rgba(79,140,255,.08), rgba(79,140,255,.02)) !important;
      border-bottom:1px solid var(--line);
      padding-top:12px;
      padding-bottom:10px;
    }
    .modalCard .bd{
      max-height: min(78vh, 680px);
      overflow:auto;
    }
    .modalClose{
      border-radius:10px !important;
      background:#fff !important;
      color:#1b2a45 !important;
      border:1px solid var(--line) !important;
      box-shadow:none !important;
    }
    .modalClose:hover{
      background:#f7fbff !important;
      border-color: rgba(79,140,255,.22) !important;
    }

    @keyframes modalPopIn{
      from{ opacity:0; transform: translateY(8px) scale(.985); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    @keyframes sheetUp{
      from{ opacity:0; transform: translateY(24px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* Mobile: use native select rendering for cleaner dropdown/picker */
    @media (max-width: 640px){
      select{
        -webkit-appearance: menulist !important;
        appearance: menulist !important;
        background-image: none !important;
        padding-inline-start: 10px !important;
        padding-inline-end: 10px !important;
        min-height: 48px;
        font-size: 14px !important;
      }
      #exerciseSelect{
        font-size: 13.5px !important;
      }
      .modal{
        align-items:flex-end !important;
        justify-content:center;
        padding:0 !important;
        background: rgba(15, 23, 42, .26) !important;
      }
      .modalCard{
        width:100% !important;
        max-height: 92vh;
        border-radius: 18px 18px 0 0 !important;
        border-bottom-left-radius: 0 !important;
        border-bottom-right-radius: 0 !important;
        animation: sheetUp .2s ease;
      }
      .modalCard .hd{
        position: sticky;
        top: 0;
        z-index: 1;
      }
      .modalCard .hd::before{
        content:"";
        position:absolute;
        top:6px;
        left:50%;
        transform:translateX(-50%);
        width:42px;
        height:4px;
        border-radius:999px;
        background: rgba(108,122,149,.35);
      }
      .modalCard .hd h2{
        margin-top:8px;
      }
      .modalCard .bd{
        max-height: calc(92vh - 64px);
        overflow:auto;
        padding-bottom:16px;
      }
    }

  
    /* Hide duplicate name chips; keep one welcome greeting in home hero */
    #userIdentityPill{display:none !important;}
    #headerGreetingLine{display:none !important;}

    /* Planner modal */
    .plannerModalCard .bd{ padding-top:12px; }
    .plannerBox{
      border:1px solid var(--line);
      border-radius:16px;
      background: linear-gradient(180deg, #ffffff, #f8fbff);
      padding:12px;
    }
    .plannerRowTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .plannerAllToggle{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      color:#1e2d49;
      cursor:pointer;
      user-select:none;
    }
    .plannerAllToggle input{ width:18px; height:18px; }
    .plannerChecks{
      margin-top:10px;
      display:grid;
      grid-template-columns:repeat(4, minmax(0, 1fr));
      gap:8px;
    }
    .plannerChecks label{
      display:flex;
      align-items:center;
      gap:6px;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      font-weight:700;
      color:#20304e;
      cursor:pointer;
      min-height:42px;
    }
    .plannerChecks label input{ width:16px; height:16px; accent-color: var(--accent); }
    .plannerOutput{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
      line-height:1.75;
      color:#1b2943;
      white-space:normal;
    }
    .plannerOutput .planDay{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      margin-top:8px;
      background: #fbfdff;
    }
    .plannerOutput .planDay:first-child{ margin-top:0; }
    .plannerOutput .planDay h4{
      margin:0 0 6px;
      font-family:"Alexandria", var(--font);
      font-size:13px;
      color:#17243a;
    }
    .plannerOutput .planMeta{
      color:var(--muted);
      font-size:12px;
      margin-bottom:6px;
    }
    .plannerOutput ul{
      margin:0;
      padding-right:18px;
    }
    .plannerOutput li{ margin:2px 0; }
    
    
    /* Actions column: keep buttons fully visible on mobile */
    .table th.actionsCol,
    .table td.actionsCol{
      min-width: 132px;
      width: 132px;
      text-align: center;
    }
    .rowActions{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      flex-wrap:nowrap;
      width:100%;
    }
    .rowActions button{
      min-width:58px;
      height:38px;
      padding:7px 10px;
      border-radius:12px !important;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      line-height:1;
      white-space:nowrap;
      margin:0 !important;
      flex:0 0 auto;
      font-size:12px;
      font-weight:800;
    }
    @media (max-width:520px){
      .table th.actionsCol,
      .table td.actionsCol{
        min-width: 118px !important;
        width: 118px !important;
      }
      .rowActions{
        flex-direction:column;
        align-items:stretch;
        gap:6px;
      }
      .rowActions button{
        width:100%;
        min-width:0;
        height:36px;
        padding:6px 8px;
        font-size:11.5px;
      }
    }


#btnCancelEdit{ border-color: rgba(255,170,0,.35); }
    @media (max-width:860px){
      .plannerChecks{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width:480px){
      .plannerChecks{ grid-template-columns:1fr; }
    }


  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠ</h1>
      <p class="sub">ØªØ§Ø¨Ø¹ Ø³Ø¹Ø±Ø§ØªÙƒØŒ Ø¨Ø±ÙˆØªÙŠÙ†Ùƒ ÙˆØªÙ…Ø§Ø±ÙŠÙ†Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© â€” ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ âœ…</p>
      <div class="topUserBar" id="userBar" hidden>
        <span class="pill identityPill" id="userIdentityPill">
          <span class="avatar" id="userAvatar"><span id="userAvatarText">ØŸ</span><img id="userAvatarImg" alt="" hidden /></span>
          <span id="userNameText">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>
        </span>
        <div class="btns topUserBtns">
          <button class="secondary" id="btnAccount" type="button">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</button>
          <button class="secondary" id="btnEditProfile" type="button">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
          <button class="secondary" id="btnLogout" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

          </div>
  </header>

  
  <section class="wrap" id="authPanel">
    <section class="card authCard">
      <div class="hd">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
        <span class="pill">Firebase</span>
      </div>
      <div class="bd">
        <div class="row2">
          <div>
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input id="authEmail" type="email" inputmode="email" autocomplete="email" placeholder="name@example.com" />
          </div>
          <div>
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input id="authPassword" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          </div>
        </div>
        <div class="btns authBtns">
          <button id="btnLogin" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
          <button class="secondary" id="btnRegister" type="button">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
          <button class="secondary" id="btnForgot" type="button">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
        </div>
        <div class="hint">Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ Ø³ØªÙØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ FirebaseØŒ ÙˆØ¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø³ØªØ¸Ù‡Ø± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>
        <div class="pill" id="authMsg" hidden></div>
      </div>
    </section>
  </section>

  <main id="appMain" class="wrap grid" hidden>
    <section id="homeHub" hidden>
      <div class="welcomeHero">
        <h2 id="welcomeGreeting">Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹</h2>
        <p id="welcomeSubtitle">ØªØ§Ø¨Ø¹ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ ÙˆØ®Ø·ØªÙƒ ÙˆØªÙ…Ø§Ø±ÙŠÙ†Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
      </div>
      <div class="cardsGrid">
        <article class="homeCard card-daily" data-open="daily">
          <div class="icon" aria-hidden="true">ğŸ§®</div>
          <h3>Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
          <div class="desc">BMR Ùˆ TDEE ÙˆØ§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù…Ù‚ØªØ±Ø­.</div>
          <div class="quick" id="homeQuickDaily">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†</div>
        </article>
        <article class="homeCard card-diet" data-open="diet">
          <div class="icon" aria-hidden="true">ğŸ¥—</div>
          <h3>Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</h3>
          <div class="desc">ÙˆØ¬Ø¨Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù…Ù‚ØªØ±Ø­Ø© Ø­Ø³Ø¨ Ù‡Ø¯ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.</div>
          <div class="quick" id="homeQuickDiet">Ø³ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨</div>
        </article>
        <article class="homeCard card-workout" data-open="workout">
          <div class="icon" aria-hidden="true">ğŸ‹ï¸</div>
          <h3>Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h3>
          <div class="desc">Ø§Ù„Ø³Ø¬Ù„ØŒ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†ØŒ ÙˆØ§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ.</div>
          <div class="quick" id="homeQuickWorkout">0 Ø³Ø·Ø±</div>
        </article>
      </div>
    </section>

    <section id="detailShell" hidden>
      <div id="detailHeader">
        <div id="detailTitle">Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
        <button class="secondary" id="detailBackBtn" type="button">â† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
      <div id="detailViews"></div>
    </section>

    <section class="card">
      <div class="hd">
        <h2 id="profileCardTitle">Ù¡) Ø¨ÙŠØ§Ù†Ø§ØªÙƒ + Ø§Ù„Ø­Ø³Ø¨Ø©</h2>
        <span class="pill" id="saveState">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</span>
      </div>
      <div class="bd">
        <div id="profileFormSection">
        <div class="row2">
          <div>
            <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø§Ø²" />
          </div>
          <div>
            <label>Ø§Ù„Ø¬Ù†Ø³</label>
            <select id="sex">
              <option value="male">Ø°ÙƒØ±</option>
              <option value="female">Ø£Ù†Ø«Ù‰</option>
            </select>
          </div>
        </div>

        <div class="row2" style="margin-top:10px;">
          <div>
            <label>Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†Ø©)</label>
            <input id="age" type="number" min="10" max="90" step="1" placeholder="Ù…Ø«Ø§Ù„: 39" />
          </div>
          <div>
            <label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
            <input id="height" type="number" min="120" max="230" step="0.1" placeholder="Ù…Ø«Ø§Ù„: 172" />
          </div>
        </div>

        <div class="row2" style="margin-top:10px;">
          <div>
            <label>Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label>
            <input id="weight" type="number" min="30" max="250" step="0.1" placeholder="Ù…Ø«Ø§Ù„: 84" />
          </div>
          <div>
            <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ</label>
            <select id="activity">
              <option value="1.2">Ù‚Ù„ÙŠÙ„ Ø¬Ø¯Ø§Ù‹ (Ø¹Ù…Ù„ Ù…ÙƒØªØ¨ÙŠ/Ø¨Ø¯ÙˆÙ† Ø±ÙŠØ§Ø¶Ø©)</option>
              <option value="1.375">Ø®ÙÙŠÙ (Ù¡â€“Ù£ Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
              <option value="1.55" selected>Ù…ØªÙˆØ³Ø· (Ù£â€“Ù¥ Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
              <option value="1.725">Ø¹Ø§Ù„ÙŠ (Ù¦â€“Ù§ Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
              <option value="1.9">Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (Ø¹Ù…Ù„ Ø´Ø§Ù‚ + ØªØ¯Ø±ÙŠØ¨)</option>
            </select>
          </div>
        </div>

        <div class="row2" style="margin-top:10px;">
          <div>
            <label>Ø§Ù„Ù‡Ø¯Ù</label>
            <select id="goal">
              <option value="cut">Ø¥Ù†Ù‚Ø§Øµ ÙˆØ²Ù† (Cut)</option>
              <option value="recomp" selected>Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ÙƒÙŠØ¨ (Recomp)</option>
              <option value="bulk">Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¶Ù„ (Lean Bulk)</option>
              <option value="maintain">ØªØ«Ø¨ÙŠØª ÙˆØ²Ù† (Maintain)</option>
            </select>
          </div>
          <div>
            <label>Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¡/Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ</label>
            <select id="cardioPref">
              <option value="none">Ù„Ø§ Ø£Ø±ØºØ¨ Ø¨ÙƒØ§Ø±Ø¯ÙŠÙˆ</option>
              <option value="light" selected>Ø®ÙÙŠÙ</option>
              <option value="moderate">Ù…ØªÙˆØ³Ø·</option>
              <option value="high">Ø¹Ø§Ù„ÙŠ</option>
            </select>
          
          
</div>
        </div>

        <div class="btns">
          <button id="calcBtn">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†</button>
          <button class="secondary" id="saveBtn">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <button class="danger" id="resetBtn">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <div class="hr"></div>

        </div>

        <div class="hint" id="profileLockHint" hidden>ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø²Ø± "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ".</div>

        <div class="kpis">
          <div class="kpi">
            <div class="t">BMR (Ø­Ø±Ù‚ Ø§Ù„Ø±Ø§Ø­Ø©)</div>
            <div class="v" id="bmrOut">â€”</div>
            <div class="s">ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ø¯Ù„Ø© Mifflinâ€“St Jeor.</div>
          </div>
          <div class="kpi">
            <div class="t">TDEE (Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ)</div>
            <div class="v" id="tdeeOut">â€”</div>
            <div class="s">BMR Ã— Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·.</div>
          </div>
          <div class="kpi">
            <div class="t">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù„Ù‡Ø¯Ù</div>
            <div class="v" id="calOut">â€”</div>
            <div class="s" id="calNote">â€”</div>
          </div>
          <div class="kpi">
            <div class="t">Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù…Ù‚ØªØ±Ø­</div>
            <div class="v" id="proOut">â€”</div>
            <div class="s" id="proNote">â€”</div>
          </div>
          <div class="kpi kpi-soft-blue">
            <div class="t">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="v" id="weightOut">â€”</div>
            <div class="s" id="weightNote">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</div>
          </div>
          <div class="kpi kpi-soft-green">
            <div class="t">Ø§Ù„Ø·ÙˆÙ„ + BMI</div>
            <div class="v" id="bmiOut">â€”</div>
            <div class="s" id="bmiNote">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù† Ù„Ø­Ø³Ø§Ø¨ BMI.</div>
          </div>
          <div class="kpi kpi-soft-peach">
            <div class="t">Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="v" id="heightOut">â€”</div>
            <div class="s" id="heightNote">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ±.</div>
          </div>
          <div class="kpi kpi-soft-violet">
            <div class="t">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ù‚ØªØ±Ø­ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div>
            <div class="v" id="weightTargetOut">â€”</div>
            <div class="s" id="weightTargetNote">ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ BMI Ø§Ù„ØµØ­ÙŠ.</div>
          </div>
        </div>

      </div>
      <div class="footer">

        <div class="muted">Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (7 Ø£ÙŠØ§Ù…) â€” Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±Ø¬Øª Ø§Ù„Ø°ÙŠ ÙŠØ­Ø³Ø¨Ù‡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</div>
        <div class="kpi" style="margin-top:10px;">
          <div class="t">Ø§Ù„Ø®Ø·Ø© ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†"</div>
          <div class="s" id="mealPlanOut">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†".</div>
        </div>
      

      </div>
    </section>

    <section class="card">
      <div class="hd">
        <h2>Ù¢) Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† + Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h2>
        <div class="tabs" id="tabs">
          <div class="tab active" data-tab="log">Ø§Ù„Ø³Ø¬Ù„</div>
          <div class="tab" data-tab="plan">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
          <div class="tab" data-tab="library">Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</div>
          <div class="tab" data-tab="tips">Ù†ØµØ§Ø¦Ø­</div>
        </div>
      </div>

      <div class="bd">
        <div id="tab-log">
          <div class="row2">
            <div>
              <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø¶Ù„ÙŠØ©</label>
              <select id="daySelect">
                <option value="chest" selected>ØµØ¯Ø±</option>
                <option value="triceps">ØªØ±Ø§ÙŠ</option>
                <option value="shoulders">Ø£ÙƒØªØ§Ù</option>
                <option value="core">Ù…Ø¹Ø¯Ø©</option>
                <option value="back">Ø¸Ù‡Ø±ÙŠ</option>
                <option value="biceps">Ø¨Ø§ÙŠ</option>
                <option value="legs">Ø±Ø¬ÙˆÙ„</option>
                <option value="cardio">ÙƒØ§Ø±Ø¯ÙŠÙˆ</option>
</select>
            </div>
            <div>
              <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <input id="dateInput" type="date" />
            </div>
          </div>

          <div class="row2" style="margin-top:10px;">
            <div>
              <label>Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
              <select id="exerciseSelect"></select>
            </div>
            <div>
              <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="noteInput" type="text" placeholder="Ù…Ø«Ø§Ù„: RPE 8 / ØªÙ‚Ù†ÙŠØ© Ø¨Ø·ÙŠØ¦Ø©" />
            </div>
          </div>

          <div class="row2" style="margin-top:10px;">
            <div>
              <label id="repsLabel">Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª (Reps)</label>
              <input id="repsInput" type="text" inputmode="numeric" autocomplete="off" oninput="this.value=this.value.replace(/[^0-9,ØŒ\s]/g,\'\')" placeholder="Ù…Ø«Ø§Ù„: 12,10,8 Ø£Ùˆ 12 10 8" />
            </div>
            <div>
              <label id="loadLabel">Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label>
              <input id="loadInput" type="text" inputmode="decimal" autocomplete="off" oninput="this.value=this.value.replace(/[^0-9,ØŒ\.\s]/g,\'\')" placeholder="Ù…Ø«Ø§Ù„: 40,45,50 Ø£Ùˆ 40 45 50" />
            </div>
          </div>

          <div class="btns">
            <button id="addSetBtn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„</button>
            <button class="secondary" id="btnCancelEdit" type="button" hidden>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="secondary" id="btnPlannerModal" type="button">ğŸ—“ï¸ Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ Ø¬Ø¯ÙˆÙ„ ØªÙ…Ø±ÙŠÙ†</button>
            <button class="secondary" id="exportBtn">ØªØµØ¯ÙŠØ± CSV</button>
            <button class="danger" id="clearLogBtn">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
          </div>

          <div class="split">
            <div class="badge" id="logCount">0 Ø³Ø·Ø±</div>
            <div class="badge" id="sortState">ØªØ±ØªÙŠØ¨: Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</div>
          </div>

          <div style="margin-top:10px; overflow:auto;">
            <table class="table" id="logTable">
              <thead>
                <tr>
                  <th>ØªØ§Ø±ÙŠØ®</th>
                  <th>ØªÙ‚Ø³ÙŠÙ…Ø©</th>
                  <th>ØªÙ…Ø±ÙŠÙ†</th>
                  <th>Ø§Ù„Ø¹Ø¶Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</th>
                  <th>Reps</th>
                  <th>Kg</th>
                  <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                  <th class="actionsCol">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

  
        </div>

        <div id="tab-plan" style="display:none;">
          <div class="kpi" style="margin-bottom:10px;">
            <div class="t">Ù…Ù‚ØªØ±Ø­Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” Ø£Ù†Øª ØªØ®ØªØ§Ø± Ø¬Ø¯ÙˆÙ„Ùƒ</div>
            <div class="s">
              <ul style="margin:8px 0 0; padding-right:18px;">
                <li><b>Ø§Ù„ÙŠÙˆÙ… 1:</b> ØµØ¯Ø± + ØªØ±Ø§ÙŠ</li>
                <li><b>Ø§Ù„ÙŠÙˆÙ… 2:</b> Ø£ÙƒØªØ§Ù + Ù…Ø¹Ø¯Ø© + Ø³ÙˆØ§Ø¹Ø¯</li>
                <li><b>Ø§Ù„ÙŠÙˆÙ… 3:</b> Ø¸Ù‡Ø± + Ø¨Ø§ÙŠ</li>
                <li><b>Ø§Ù„ÙŠÙˆÙ… 4:</b> Ø±Ø¬Ù„</li>
              </ul>
            </div>
          </div>

          <div class="row2">
            <div class="kpi">
              <div class="t">Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ø¬Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†</div>
              <div class="s">
                <ul style="margin:8px 0 0; padding-right:18px;">
                  <li>ÙƒÙ„ Ø¹Ø¶Ù„Ø© ÙƒØ¨ÙŠØ±Ø©: 10â€“16 Ù…Ø¬Ù…ÙˆØ¹Ø©/Ø£Ø³Ø¨ÙˆØ¹ (Ø­Ø³Ø¨ Ø®Ø¨Ø±ØªÙƒ ÙˆØªØ¹Ø§ÙÙŠÙƒ)</li>
                  <li>Ø¹Ø¶Ù„Ø§Øª ØµØºÙŠØ±Ø©: 6â€“10 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª/Ø£Ø³Ø¨ÙˆØ¹</li>
                  <li>ÙƒØ±Ø± 6â€“12 Ø¹Ø¯Ø© Ù„Ù…Ø¹Ø¸Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† (Ù‚ÙˆØ©: 3â€“6 / ØªØ¶Ø®ÙŠÙ…: 6â€“12 / Ø¹Ø²Ù„: 10â€“20)</li>
                </ul>
              </div>
            </div>
            <div class="kpi">
              <div class="t">Progressive Overload</div>
              <div class="s">
                <ul style="margin:8px 0 0; padding-right:18px;">
                  <li>Ø¥Ø°Ø§ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¹Ø¯Ù‘Ø§Øª Ø¨Ù†ÙØ³ Ø§Ù„ØªÙ‚Ù†ÙŠØ©: Ø²ÙØ¯ Ø§Ù„ÙˆØ²Ù† 2.5â€“5%</li>
                  <li>Ø£Ùˆ Ø²ÙØ¯ 1â€“2 Ø¹Ø¯Ø© Ù‚Ø¨Ù„ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ²Ù†</li>
                  <li>Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ RPE 7â€“9 Ù„Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="hint" style="margin-top:10px;">
            ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù (Ù‚Ø³Ù… <span class="muted">EXERCISES</span>) Ù„Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø§Ø±ÙŠÙ†Ùƒ Ø§Ù„Ø®Ø§ØµØ©.
          </div>
        </div>

        <div id="tab-library" style="display:none;">
          <div class="row2">
            <div>
              <label>Ø¨Ø­Ø«</label>
              <input id="libSearch" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… ØªÙ…Ø±ÙŠÙ† Ø£Ùˆ Ø¹Ø¶Ù„Ø©..." />
            </div>
            <div>
              <label>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…Ø©</label>
              <select id="libSplitFilter">
                <option value="all" selected>Ø§Ù„ÙƒÙ„</option>
                <option value="chest">ØµØ¯Ø±</option>
                <option value="triceps">ØªØ±Ø§ÙŠ</option>
                <option value="shoulders">Ø£ÙƒØªØ§Ù</option>
                <option value="core">Ù…Ø¹Ø¯Ø©</option>
                <option value="back">Ø¸Ù‡Ø±ÙŠ</option>
                <option value="biceps">Ø¨Ø§ÙŠ</option>
                <option value="legs">Ø±Ø¬ÙˆÙ„</option>
                <option value="cardio">ÙƒØ§Ø±Ø¯ÙŠÙˆ</option>
</select>
            </div>
          </div>

          <div style="margin-top:10px; overflow:auto;">
            <table class="table" id="libTable">
              <thead>
                <tr>
                  <th>Ø§Ù„ØªÙ…Ø±ÙŠÙ†</th>
                  <th>Ø§Ù„Ø¹Ø¶Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</th>
                  <th>ØªÙ‚Ø³ÙŠÙ…Ø©</th>
                  <th>ØªÙƒÙ†ÙŠÙƒ Ù…Ø®ØªØµØ±</th>
                  <th>ÙÙŠØ¯ÙŠÙˆ</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="hint">
            Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø¨Ø­Ø« Ø¬Ø§Ù‡Ø² ÙÙŠ ÙŠÙˆØªÙŠÙˆØ¨ Ø¨Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø±ÙˆØ§Ø¨Ø· Ù…Ø­Ø¯Ø¯Ø©).
          </div>
        </div>

        <div id="tab-tips" style="display:none;">
          <div class="row2">
            <div class="kpi">
              <div class="t">Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ: Ù…ØªÙ‰ ÙˆÙƒÙŠÙØŸ</div>
              <div class="s" id="cardioAdvice">â€”</div>
            </div>
            <div class="kpi">
              <div class="t">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£ÙƒÙ„ Ø³Ø±ÙŠØ¹Ø©</div>
              <div class="s" id="foodAdvice">â€”</div>
            </div>
          </div>

          <div class="kpi" style="margin-top:10px;">
            <div class="t">ØªÙ‚Ù†ÙŠØ© Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ù…Ø®ØªØµØ±)</div>
            <div class="s">
              <ul style="margin:8px 0 0; padding-right:18px;">
                <li><b>Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒÙŠ:</b> ÙƒØ§Ù…Ù„ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† Ø¨Ø¯ÙˆÙ† Ø£Ù„Ù….</li>
                <li><b>Ø§Ù„ØªØ­ÙƒÙ…:</b> Ù†Ø²ÙˆÙ„ Ø¨Ø·ÙŠØ¡ 2â€“3 Ø«ÙˆØ§Ù†ÙŠØŒ ØµØ¹ÙˆØ¯ Ù‚ÙˆÙŠ.</li>
                <li><b>Ø§Ù„ØªÙ†ÙØ³:</b> Ø´Ù‡ÙŠÙ‚ ÙÙŠ Ø§Ù„Ù†Ø²ÙˆÙ„ØŒ Ø²ÙÙŠØ± ÙÙŠ Ø§Ù„ØµØ¹ÙˆØ¯.</li>
                <li><b>Ø§Ù„Ø£Ù…Ø§Ù†:</b> ØªÙˆÙ‚Ù Ø¥Ø°Ø§ Ø¸Ù‡Ø± Ø£Ù„Ù… Ø­Ø§Ø¯ Ø£Ùˆ Ø¯ÙˆØ®Ø©. Ø§Ø³ØªØ®Ø¯Ù… Spotter ÙÙŠ Ø§Ù„Ø¨Ù†Ø´/Ø§Ù„Ø³ÙƒÙˆØ§Øª.</li>
              </ul>
            </div>
          </div>

          <div class="kpi" style="margin-top:10px;">
            <div class="t">ÙƒÙŠÙ ØªØªÙ‚Ø¯Ù… Ø¨Ø³Ø±Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø¥ØµØ§Ø¨Ø§ØªØŸ</div>
            <div class="s">
              <ul style="margin:8px 0 0; padding-right:18px;">
                <li>Ø³Ø®Ù‘Ù† 5â€“8 Ø¯Ù‚Ø§Ø¦Ù‚ + Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ØªÙ…Ù‡ÙŠØ¯ÙŠØ© Ø®ÙÙŠÙØ© Ù‚Ø¨Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø«Ù‚ÙŠÙ„.</li>
                <li>Ø§Ù„Ù†ÙˆÙ… 7â€“9 Ø³Ø§Ø¹Ø§ØªØŒ ÙˆØ®ÙÙ‘Ù Ø§Ù„Ø­Ø¬Ù… Ø¥Ø°Ø§ ØªØ¹Ø¨Øª Ø£Ùˆ Ù‚Ù„ Ø§Ù„Ù†ÙˆÙ….</li>
                <li>Ù„Ø§ ØªÙÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„Ù„ÙØ´Ù„Ø› Ø§Ø¬Ø¹Ù„ 1â€“2 Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙ‚Ø· Ù‚Ø±Ø¨ Ø§Ù„ÙØ´Ù„.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      
    </section>
  </main>


  <div class="modal" id="accountModal" hidden>
    <section class="card modalCard">
      <div class="hd">
        <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
        <button class="modalClose" id="btnCloseAccount" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="bd">
        <div class="row2">
          <div>
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø± (Display Name)</label>
            <input id="accDisplayName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨Ùˆ Ø¬Ù…Ø§Ù„" />
          </div>
          <div>
            <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="accPhotoUrl" type="url" inputmode="url" placeholder="https://..." />
          </div>
        </div>

        <div class="btns">
          <button id="btnSaveAccount" type="button">Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</button>
          <button class="secondary" id="btnVerifyEmail" type="button">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</button>
        </div>

        <div class="hr"></div>

        <div class="row2">
          <div>
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
            <input id="accCurrentPass" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          </div>
          <div>
            <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</label>
            <input id="accNewPass" type="password" autocomplete="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          </div>
        </div>

        <div class="btns">
          <button class="secondary" id="btnChangePassword" type="button">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
          <button class="secondary" id="btnResetPasswordEmail" type="button">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>

        <div class="pill" id="accountMsg" hidden></div>
        <div class="hint">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚Ø¯ ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ«. Ø¥Ø°Ø§ Ø¸Ù‡Ø± ØªÙ†Ø¨ÙŠÙ‡ â€œØ£Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„â€ØŒ Ø³Ø¬Ù‘Ù„ Ø®Ø±ÙˆØ¬ Ø«Ù… Ø§Ø¯Ø®Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙˆØ­Ø§ÙˆÙ„.</div>
      </div>
    </section>
  </div>

  <div class="modal" id="plannerModal" hidden>
    <section class="card modalCard plannerModalCard">
      <div class="hd">
        <h2>Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙˆÙ„ ØªÙ…Ø±ÙŠÙ†</h2>
        <button class="modalClose" id="btnClosePlanner" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="bd">
        <div class="hint" style="margin-bottom:10px;">
          Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ¯Ø±ÙŠØ¨Ù‡Ø§ØŒ Ø«Ù… Ø¯Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠÙ‚ØªØ±Ø­ Ù„Ùƒ Ø®Ø·Ø© <b>ÙŠÙˆÙ…ÙŠØ©</b> Ø£Ùˆ <b>Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</b> Ø£Ùˆ <b>Ø´Ù‡Ø±ÙŠØ©</b>.
        </div>

        <div class="plannerBox">
          <div class="plannerRowTop">
            <label class="plannerAllToggle">
              <input type="checkbox" id="plannerAllMuscles" checked />
              <span>ÙƒÙ„ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª</span>
            </label>
            <span class="badge" id="plannerSelectedCount">8 Ø¹Ø¶Ù„Ø§Øª</span>
          </div>

          <div class="plannerChecks" id="plannerChecks">
            <label><input type="checkbox" class="plannerMuscle" value="chest" checked /> ØµØ¯Ø±</label>
            <label><input type="checkbox" class="plannerMuscle" value="triceps" checked /> ØªØ±Ø§ÙŠ</label>
            <label><input type="checkbox" class="plannerMuscle" value="shoulders" checked /> Ø£ÙƒØªØ§Ù</label>
            <label><input type="checkbox" class="plannerMuscle" value="core" checked /> Ù…Ø¹Ø¯Ø©</label>
            <label><input type="checkbox" class="plannerMuscle" value="back" checked /> Ø¸Ù‡Ø±ÙŠ</label>
            <label><input type="checkbox" class="plannerMuscle" value="biceps" checked /> Ø¨Ø§ÙŠ</label>
            <label><input type="checkbox" class="plannerMuscle" value="legs" checked /> Ø±Ø¬ÙˆÙ„</label>
            <label><input type="checkbox" class="plannerMuscle" value="cardio" checked /> ÙƒØ§Ø±Ø¯ÙŠÙˆ</label>
          </div>

          <div class="row2" style="margin-top:10px;">
            <div>
              <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø©</label>
              <select id="plannerPeriod">
                <option value="daily">Ø®Ø·Ø© ÙŠÙˆÙ…ÙŠØ©</option>
                <option value="weekly" selected>Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</option>
                <option value="monthly">Ø®Ø·Ø© Ø´Ù‡Ø±ÙŠØ© (4 Ø£Ø³Ø§Ø¨ÙŠØ¹)</option>
              </select>
            </div>
            <div>
              <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
              <select id="plannerDaysPerWeek">
                <option value="2">2 Ø£ÙŠØ§Ù…</option>
                <option value="3">3 Ø£ÙŠØ§Ù…</option>
                <option value="4" selected>4 Ø£ÙŠØ§Ù…</option>
                <option value="5">5 Ø£ÙŠØ§Ù…</option>
                <option value="6">6 Ø£ÙŠØ§Ù…</option>
              </select>
            </div>
          </div>

          <div class="row2" style="margin-top:10px;">
            <div>
              <label>Ù‡Ø¯Ù Ø§Ù„Ø®Ø·Ø©</label>
              <select id="plannerGoalStyle">
                <option value="hypertrophy" selected>ØªØ¶Ø®ÙŠÙ… / Ø¨Ù†Ø§Ø¡ Ø¹Ø¶Ù„</option>
                <option value="fatloss">ØªÙ†Ø´ÙŠÙ / Ø­Ø±Ù‚ Ø¯Ù‡ÙˆÙ†</option>
                <option value="general">Ù„ÙŠØ§Ù‚Ø© Ø¹Ø§Ù…Ø©</option>
              </select>
            </div>
            <div>
              <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
              <select id="plannerLevel">
                <option value="beginner" selected>Ù…Ø¨ØªØ¯Ø¦</option>
                <option value="intermediate">Ù…ØªÙˆØ³Ø·</option>
                <option value="advanced">Ù…ØªÙ‚Ø¯Ù…</option>
              </select>
            </div>
          </div>

          <div class="btns" style="margin-top:12px;">
            <button id="btnGeneratePlanner" type="button">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            <button class="secondary" id="btnAddPlannerToLog" type="button">â• Ø£Ø¶Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªÙ…Ø§Ø±ÙŠÙ†ÙŠ</button>
            <button class="secondary" id="btnCopyPlanner" type="button">Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
          </div>

          <div class="plannerOutput" id="plannerOutput">
            Ø§Ø¶ØºØ· <b>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„</b> Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø®Ø·Ø© Ù‡Ù†Ø§.
          </div>
        </div>
      </div>
    </section>
  </div>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics, isSupported as analyticsSupported } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence, sendPasswordResetEmail, sendEmailVerification, updateProfile, updatePassword, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyACO9JC1Bj0mexLHgi0l3lDJIOYUizWaEI",
      authDomain: "hse-calendar-3eb45.firebaseapp.com",
      projectId: "hse-calendar-3eb45",
      storageBucket: "hse-calendar-3eb45.firebasestorage.app",
      messagingSenderId: "1047298015875",
      appId: "1:1047298015875:web:c8ae004f85eba074a991b6",
      measurementId: "G-ZRYK11SNX4"
    };

    const $ = (id) => document.getElementById(id);
    const fmt = (n) => Number.isFinite(n) ? Math.round(n) : "â€”";
    const todayISO = () => new Date().toISOString().slice(0,10);

    const EXERCISES = [
      // ØµØ¯Ø± (Chest)
      {id:"bench_press", name:"Ø¨Ù†Ø´ Ø¨Ø±Ø³ Ø¨Ø§Ø± (Barbell Bench Press)", target:"ØµØ¯Ø± + ØªØ±Ø§ÙŠ", split:"chest", cue:"Ø«Ø¨Øª Ù„ÙˆØ­ Ø§Ù„ÙƒØªÙ Ù„Ù„Ø®Ù„ÙØŒ Ù„Ù…Ø³ Ø®ÙÙŠÙØŒ Ø§Ø¯ÙØ¹ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹.", yt:"https://www.youtube.com/results?search_query=Barbell+Bench+Press+proper+form"},
      {id:"incline_bench", name:"Ø¨Ù†Ø´ Ù…Ø§Ø¦Ù„ Ø¨Ø§Ø± (Incline Bench Press)", target:"ØµØ¯Ø± Ø¹Ù„ÙˆÙŠ + ÙƒØªÙ Ø£Ù…Ø§Ù…ÙŠ", split:"chest", cue:"Ø²Ø§ÙˆÙŠØ© 20â€“30Â°ØŒ ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù†Ø²ÙˆÙ„.", yt:"https://www.youtube.com/results?search_query=Incline+Bench+Press+proper+form"},
      {id:"decline_bench", name:"Ø¨Ù†Ø´ Ø¯ÙŠÙƒÙ„Ø§Ù† Ø¨Ø§Ø± (Decline Bench Press)", target:"ØµØ¯Ø± Ø³ÙÙ„ÙŠ", split:"chest", cue:"Ù…Ø¯Ù‰ ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¶ØºØ· ÙƒØªÙ.", yt:"https://www.youtube.com/results?search_query=Decline+Bench+Press+proper+form"},
      {id:"db_bench", name:"Ø¨Ù†Ø´ Ø¯Ù…Ø¨Ù„ Ù…Ø³ØªÙˆÙŠ (DB Bench Press)", target:"ØµØ¯Ø±", split:"chest", cue:"Ù†Ø²ÙˆÙ„ Ù…ØªØ­ÙƒÙ…ØŒ Ù„Ø§ ØªØµØ¯Ù… Ø§Ù„Ø¯Ù…Ø¨Ù„.", yt:"https://www.youtube.com/results?search_query=Dumbbell+Bench+Press+proper+form"},
      {id:"incline_db", name:"Ø¨Ù†Ø´ Ù…Ø§Ø¦Ù„ Ø¯Ù…Ø¨Ù„ (Incline DB Press)", target:"ØµØ¯Ø± Ø¹Ù„ÙˆÙŠ", split:"chest", cue:"Ø²Ø§ÙˆÙŠØ© 20â€“30Â°ØŒ Ù„Ø§ ØªØ±ÙØ¹ Ø§Ù„ÙƒØªÙ.", yt:"https://www.youtube.com/results?search_query=Incline+Dumbbell+Press+proper+form"},
      {id:"machine_chest_press", name:"Ø¬Ù‡Ø§Ø² Ø¶ØºØ· ØµØ¯Ø± (Machine Chest Press)", target:"ØµØ¯Ø±", split:"chest", cue:"Ø«Ø¨Øª Ø§Ù„Ø¸Ù‡Ø±ØŒ Ø§Ø¯ÙØ¹ Ù„Ù„Ø£Ù…Ø§Ù… Ø¨Ø¯ÙˆÙ† Ù‚ÙÙ„.", yt:"https://www.youtube.com/results?search_query=Machine+Chest+Press+proper+form"},
      {id:"smith_incline", name:"Ø³Ù…ÙŠØ« Ù…Ø§Ø¦Ù„ (Smith Incline Press)", target:"ØµØ¯Ø± Ø¹Ù„ÙˆÙŠ", split:"chest", cue:"Ù…Ø³Ø§Ø± Ø«Ø§Ø¨ØªØŒ ØªØ­ÙƒÙ….", yt:"https://www.youtube.com/results?search_query=Smith+Machine+Incline+Press+proper+form"},
      {id:"cable_fly", name:"ÙÙ„Ø§ÙŠ ÙƒÙŠØ¨Ù„ (Cable Fly)", target:"ØµØ¯Ø± (Ø¹Ø²Ù„)", split:"chest", cue:"Ø§Ø¹ØµØ± Ø§Ù„ØµØ¯Ø± ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ.", yt:"https://www.youtube.com/results?search_query=Cable+Fly+proper+form"},
      {id:"pec_deck", name:"Ø¨ÙŠÙƒ Ø¯ÙŠÙƒ (Pec Deck)", target:"ØµØ¯Ø± (Ø¹Ø²Ù„)", split:"chest", cue:"Ù…Ø±ÙÙ‚ Ø«Ø§Ø¨ØªØŒ Ø§Ø¹ØµØ± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.", yt:"https://www.youtube.com/results?search_query=Pec+Deck+proper+form"},
      {id:"pushup", name:"Ø¨ÙˆØ´ Ø£Ø¨ (Push-up)", target:"ØµØ¯Ø± + ØªØ±Ø§ÙŠ", split:"chest", cue:"Ø¬Ø³Ù… Ù…Ø³ØªÙ‚ÙŠÙ…ØŒ Ù…Ø¯Ù‰ ÙƒØ§Ù…Ù„.", yt:"https://www.youtube.com/results?search_query=Push+up+proper+form"},
      {id:"dip_chest", name:"Ø¯ÙŠØ¨Ø³ Ù„Ù„ØµØ¯Ø± (Chest Dips)", target:"ØµØ¯Ø± Ø³ÙÙ„ÙŠ + ØªØ±Ø§ÙŠ", split:"chest", cue:"Ù…ÙŠÙ„ Ù„Ù„Ø£Ù…Ø§Ù… Ù„Ù„ØµØ¯Ø±.", yt:"https://www.youtube.com/results?search_query=Chest+Dips+proper+form"},

      // ØªØ±Ø§ÙŠ (Triceps)
      {id:"triceps_pushdown", name:"ØªØ±Ø§ÙŠ ÙƒÙŠØ¨Ù„ (Triceps Pushdown)", target:"ØªØ±Ø§ÙŠ", split:"triceps", cue:"Ø«Ø¨Øª Ø§Ù„ÙƒÙˆØ¹ØŒ Ø§Ø¹ØµØ± Ø¨Ø§Ù„Ø£Ø³ÙÙ„.", yt:"https://www.youtube.com/results?search_query=Triceps+Pushdown+proper+form"},
      {id:"rope_pushdown", name:"ØªØ±Ø§ÙŠ Ø­Ø¨Ù„ (Rope Pushdown)", target:"ØªØ±Ø§ÙŠ", split:"triceps", cue:"Ø§ÙØªØ­ Ø§Ù„Ø­Ø¨Ù„ Ø¨Ø§Ù„Ø£Ø³ÙÙ„.", yt:"https://www.youtube.com/results?search_query=Rope+Triceps+Pushdown+proper+form"},
      {id:"overhead_triceps", name:"ØªØ±Ø§ÙŠ ÙÙˆÙ‚ Ø§Ù„Ø±Ø£Ø³ (Overhead Extension)", target:"Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø·ÙˆÙŠÙ„", split:"triceps", cue:"Ø§Ù„Ù…Ø±ÙÙ‚ Ø«Ø§Ø¨Øª Ù„Ù„Ø£Ø¹Ù„Ù‰.", yt:"https://www.youtube.com/results?search_query=Overhead+Triceps+Extension+proper+form"},
      {id:"skull_crusher", name:"Ø³ÙƒÙÙ„ ÙƒØ±Ø§Ø´Ø± (Skull Crushers)", target:"ØªØ±Ø§ÙŠ", split:"triceps", cue:"Ù„Ø§ ØªÙØªØ­ Ø§Ù„Ù…Ø±ÙÙ‚ ÙƒØ«ÙŠØ±Ø§Ù‹.", yt:"https://www.youtube.com/results?search_query=Skull+Crushers+proper+form"},
      {id:"close_grip_bench", name:"Ø¨Ù†Ø´ Ù‚Ø¨Ø¶Ø© Ø¶ÙŠÙ‚Ø© (Close Grip Bench)", target:"ØªØ±Ø§ÙŠ + ØµØ¯Ø±", split:"triceps", cue:"ÙƒÙˆØ¹ Ù‚Ø±ÙŠØ¨ Ù„Ù„Ø¬Ø³Ù….", yt:"https://www.youtube.com/results?search_query=Close+Grip+Bench+Press+proper+form"},
      {id:"bench_dip", name:"Ø¯ÙŠØ¨Ø³ ÙƒØ±Ø³ÙŠ (Bench Dips)", target:"ØªØ±Ø§ÙŠ", split:"triceps", cue:"Ù„Ø§ ØªØ°Ù‡Ø¨ Ù„Ù…Ø¯Ù‰ ÙŠÙˆØ¬Ø¹ Ø§Ù„ÙƒØªÙ.", yt:"https://www.youtube.com/results?search_query=Bench+Dips+proper+form"},
      {id:"triceps_kickback", name:"Ø±ÙƒÙ„Ø© Ø¯Ù…Ø¨Ù„ (Triceps Kickback)", target:"ØªØ±Ø§ÙŠ (Ø¹Ø²Ù„)", split:"triceps", cue:"Ø«Ø¨Ù‘Øª Ø§Ù„Ø°Ø±Ø§Ø¹ØŒ Ù…Ø¯Ù‘ Ù„Ù„Ø®Ù„Ù.", yt:"https://www.youtube.com/results?search_query=Triceps+Kickback+proper+form"},

      // Ø£ÙƒØªØ§Ù (Shoulders)
      {id:"ohp", name:"ÙƒØªÙ Ø¨Ø§Ø± ÙˆØ§Ù‚Ù (Overhead Press)", target:"Ø£ÙƒØªØ§Ù + ØªØ±Ø§ÙŠ", split:"shoulders", cue:"Ø´Ø¯ Ø§Ù„Ø¨Ø·Ù†ØŒ Ù„Ø§ ØªÙ‚ÙˆØ³ Ø§Ù„Ø¸Ù‡Ø±.", yt:"https://www.youtube.com/results?search_query=Overhead+Press+proper+form"},
      {id:"seated_db_press", name:"ÙƒØªÙ Ø¯Ù…Ø¨Ù„ Ø¬Ø§Ù„Ø³ (Seated DB Press)", target:"Ø£ÙƒØªØ§Ù", split:"shoulders", cue:"Ù…Ø¯Ù‰ Ù…ØªØ­ÙƒÙ…ØŒ Ù„Ø§ ØªØ¯ÙØ¹ Ø§Ù„Ø±Ù‚Ø¨Ø© Ù„Ù„Ø£Ù…Ø§Ù….", yt:"https://www.youtube.com/results?search_query=Seated+Dumbbell+Shoulder+Press+proper+form"},
      {id:"arnold_press", name:"Ø£Ø±Ù†ÙˆÙ„Ø¯ Ø¨Ø±Ø³ (Arnold Press)", target:"Ø£ÙƒØªØ§Ù", split:"shoulders", cue:"Ø­Ø±ÙƒØ© Ø³Ù„Ø³Ø© Ø¨Ø¯ÙˆÙ† Ø²Ø®Ù….", yt:"https://www.youtube.com/results?search_query=Arnold+Press+proper+form"},
      {id:"lateral_raise", name:"Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ© (Lateral Raise)", target:"ÙƒØªÙ Ø¬Ø§Ù†Ø¨ÙŠ", split:"shoulders", cue:"Ù…Ø±ÙÙ‚ Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙŠØ¯.", yt:"https://www.youtube.com/results?search_query=Lateral+Raise+proper+form"},
      {id:"cable_lateral", name:"Ø±ÙØ±ÙØ© ÙƒÙŠØ¨Ù„ (Cable Lateral Raise)", target:"ÙƒØªÙ Ø¬Ø§Ù†Ø¨ÙŠ", split:"shoulders", cue:"Ø«Ø¨Ø§Øª Ø£Ø¹Ù„Ù‰ØŒ Ø´Ø¯ Ù…Ø³ØªÙ…Ø±.", yt:"https://www.youtube.com/results?search_query=Cable+Lateral+Raise+proper+form"},
      {id:"rear_delt_fly", name:"Ø±ÙØ±ÙØ© Ø®Ù„ÙÙŠØ© (Rear Delt Fly)", target:"ÙƒØªÙ Ø®Ù„ÙÙŠ", split:"shoulders", cue:"Ù„Ø§ ØªØ±ÙØ¹ Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ³.", yt:"https://www.youtube.com/results?search_query=Rear+Delt+Fly+proper+form"},
      {id:"face_pull", name:"ÙÙŠØ³ Ø¨ÙˆÙ„ (Face Pull)", target:"ÙƒØªÙ Ø®Ù„ÙÙŠ + ØªØ±Ø§Ø¨ÙŠØ³", split:"shoulders", cue:"Ø§Ø³Ø­Ø¨ Ù„Ù„ÙˆØ¬Ù‡ Ù…Ø¹ Ø¯ÙˆØ±Ø§Ù† Ø®Ø§Ø±Ø¬ÙŠ.", yt:"https://www.youtube.com/results?search_query=Face+Pull+proper+form"},
      {id:"upright_row", name:"Ø³Ø­Ø¨ Ø¹Ù…ÙˆØ¯ÙŠ (Upright Row)", target:"ÙƒØªÙ/ØªØ±Ø§Ø¨ÙŠØ³", split:"shoulders", cue:"ÙˆØ²Ù† Ø®ÙÙŠÙØŒ Ù…Ø¯Ù‰ Ù…Ø±ÙŠØ­ Ù„Ù„ÙƒØªÙ.", yt:"https://www.youtube.com/results?search_query=Upright+Row+proper+form"},
      {id:"shrug", name:"Ø´Ø±Ø§Ú¯ (Shrugs)", target:"ØªØ±Ø§Ø¨ÙŠØ³", split:"shoulders", cue:"Ø§Ø±ÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰ØŒ ØªÙˆÙ‚Ù.", yt:"https://www.youtube.com/results?search_query=Shrugs+proper+form"},

      // Ù…Ø¹Ø¯Ø© (Core)
      {id:"plank", name:"Ø¨Ù„Ø§Ù†Ùƒ (Plank)", target:"ÙƒÙˆØ±", split:"core", cue:"Ø­ÙˆØ¶ Ù…Ø­Ø§ÙŠØ¯ØŒ Ø´Ø¯ Ø§Ù„Ø¨Ø·Ù†.", yt:"https://www.youtube.com/results?search_query=Plank+proper+form"},
      {id:"side_plank", name:"Ø³Ø§ÙŠØ¯ Ø¨Ù„Ø§Ù†Ùƒ (Side Plank)", target:"ÙƒÙˆØ±/Ø¬Ø§Ù†Ø¨ÙŠ", split:"core", cue:"Ø®Ø· Ù…Ø³ØªÙ‚ÙŠÙ…ØŒ Ù„Ø§ ØªÙ‡Ø¨Ø·.", yt:"https://www.youtube.com/results?search_query=Side+Plank+proper+form"},
      {id:"hanging_leg_raise", name:"Ø±ÙØ¹ Ø£Ø±Ø¬Ù„ ØªØ¹Ù„ÙŠÙ‚ (Hanging Leg Raise)", target:"Ù…Ø¹Ø¯Ø© Ø³ÙÙ„ÙŠØ©", split:"core", cue:"Ø¨Ø¯ÙˆÙ† ØªØ£Ø±Ø¬Ø­.", yt:"https://www.youtube.com/results?search_query=Hanging+Leg+Raise+proper+form"},
      {id:"cable_crunch", name:"ÙƒØ±Ù†Ø´ ÙƒÙŠØ¨Ù„ (Cable Crunch)", target:"Ù…Ø¹Ø¯Ø©", split:"core", cue:"Ù‚ÙˆØ³ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ù„Ù„Ø£Ù…Ø§Ù… Ø¨ØªØ­ÙƒÙ….", yt:"https://www.youtube.com/results?search_query=Cable+Crunch+proper+form"},
      {id:"ab_wheel", name:"Ø¹Ø¬Ù„Ø© Ø§Ù„Ø¨Ø·Ù† (Ab Wheel)", target:"ÙƒÙˆØ±", split:"core", cue:"ØªØ­ÙƒÙ…ØŒ Ù„Ø§ ØªØªØ±Ùƒ Ø£Ø³ÙÙ„ Ø§Ù„Ø¸Ù‡Ø±.", yt:"https://www.youtube.com/results?search_query=Ab+Wheel+Rollout+proper+form"},
      {id:"dead_bug", name:"Ø¯ÙŠØ¯ Ø¨ÙØº (Dead Bug)", target:"ÙƒÙˆØ±", split:"core", cue:"Ø¸Ù‡Ø± Ù…Ù„Ø§ØµÙ‚ Ù„Ù„Ø£Ø±Ø¶.", yt:"https://www.youtube.com/results?search_query=Dead+Bug+exercise+proper+form"},
      {id:"russian_twist", name:"Ø±ÙˆØ´Ù† ØªÙˆÙŠØ³Øª (Russian Twist)", target:"Ù…Ø§Ø¦Ù„/ÙƒÙˆØ±", split:"core", cue:"Ø­Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ø¬Ø°Ø¹ØŒ ÙˆØ²Ù† Ù…Ù†Ø§Ø³Ø¨.", yt:"https://www.youtube.com/results?search_query=Russian+Twist+proper+form"},

      // Ø¸Ù‡Ø±ÙŠ (Back)
      {id:"deadlift", name:"Ø¯ÙŠØ¯Ù„ÙØª (Deadlift)", target:"Ø¸Ù‡Ø± + Ø±Ø¬Ù„ Ø®Ù„ÙÙŠØ©", split:"back", cue:"Ø¸Ù‡Ø± Ù…Ø­Ø§ÙŠØ¯ØŒ Ø¨Ø§Ø± Ù‚Ø±ÙŠØ¨.", yt:"https://www.youtube.com/results?search_query=Deadlift+proper+form"},
      {id:"pullup", name:"Ø¹Ù‚Ù„Ø© (Pull-up)", target:"Ù„Ø§ØªØ³ + Ø¨Ø§ÙŠ", split:"back", cue:"Ù…Ø¯Ù‰ ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø±Ù…ÙŠ.", yt:"https://www.youtube.com/results?search_query=Pull+up+proper+form"},
      {id:"chinup", name:"Ø´Ù† Ø£Ø¨ (Chin-up)", target:"Ù„Ø§ØªØ³ + Ø¨Ø§ÙŠ", split:"back", cue:"Ù‚Ø¨Ø¶Ø© Ù…Ø¹ÙƒÙˆØ³Ø©.", yt:"https://www.youtube.com/results?search_query=Chin+up+proper+form"},
      {id:"lat_pulldown", name:"Ø³Ø­Ø¨ Ø£Ù…Ø§Ù…ÙŠ (Lat Pulldown)", target:"Ù„Ø§ØªØ³", split:"back", cue:"Ø§Ø³Ø­Ø¨ Ø¨Ø§Ù„ÙƒÙˆØ¹.", yt:"https://www.youtube.com/results?search_query=Lat+Pulldown+proper+form"},
      {id:"barbell_row", name:"Ø±Ùˆ Ø¨Ø§Ø± (Barbell Row)", target:"Ù…Ù†ØªØµÙ Ø§Ù„Ø¸Ù‡Ø±", split:"back", cue:"Ù…ÙŠÙ„ Ø«Ø§Ø¨ØªØŒ Ø§Ø³Ø­Ø¨ Ù„Ù„ÙƒÙˆØ¹.", yt:"https://www.youtube.com/results?search_query=Barbell+Row+proper+form"},
      {id:"db_row", name:"Ø³Ø­Ø¨ Ø¯Ù…Ø¨Ù„ (One-Arm DB Row)", target:"Ù„Ø§ØªØ³/Ù…Ù†ØªØµÙ Ø§Ù„Ø¸Ù‡Ø±", split:"back", cue:"Ø§Ø³Ø­Ø¨ Ù„Ù„ÙƒÙˆØ¹ Ù„Ù„Ø®Ù„Ù.", yt:"https://www.youtube.com/results?search_query=One+Arm+Dumbbell+Row+proper+form"},
      {id:"seated_row", name:"Ø±Ùˆ ÙƒÙŠØ¨Ù„ (Seated Cable Row)", target:"Ù…Ù†ØªØµÙ Ø§Ù„Ø¸Ù‡Ø±", split:"back", cue:"ÙƒØªÙ Ù„Ù„Ø£Ø³ÙÙ„.", yt:"https://www.youtube.com/results?search_query=Seated+Cable+Row+proper+form"},
      {id:"tbar_row", name:"ØªÙŠ Ø¨Ø§Ø± Ø±Ùˆ (T-Bar Row)", target:"Ù…Ù†ØªØµÙ Ø§Ù„Ø¸Ù‡Ø±", split:"back", cue:"ØªØ­ÙƒÙ…ØŒ Ù„Ø§ ØªØªØ£Ø±Ø¬Ø­.", yt:"https://www.youtube.com/results?search_query=T+Bar+Row+proper+form"},
      {id:"back_extension", name:"Ù‡Ø§ÙŠØ¨Ø± Ø§ÙƒØ³ØªÙ†Ø´Ù† (Back Extension)", target:"Ø£Ø³ÙÙ„ Ø§Ù„Ø¸Ù‡Ø±", split:"back", cue:"Ù„Ø§ ØªÙØ±Ø· Ø¨Ø§Ù„ØªÙ…Ø¯Ø¯.", yt:"https://www.youtube.com/results?search_query=Back+Extension+proper+form"},
      {id:"straight_arm_pulldown", name:"Ø³Ø­Ø¨ Ø°Ø±Ø§Ø¹ Ù…Ø³ØªÙ‚ÙŠÙ… (Straight-Arm Pulldown)", target:"Ù„Ø§ØªØ³", split:"back", cue:"Ø°Ø±Ø§Ø¹ Ø´Ø¨Ù‡ Ø«Ø§Ø¨Øª.", yt:"https://www.youtube.com/results?search_query=Straight+Arm+Pulldown+proper+form"},

      // Ø¨Ø§ÙŠ (Biceps)
      {id:"db_curl", name:"Ø¨Ø§ÙŠ Ø¯Ù…Ø¨Ù„ (DB Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ø«Ø¨Øª Ø§Ù„ÙƒÙˆØ¹.", yt:"https://www.youtube.com/results?search_query=Dumbbell+Curl+proper+form"},
      {id:"barbell_curl", name:"Ø¨Ø§ÙŠ Ø¨Ø§Ø± (Barbell Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ø¨Ø¯ÙˆÙ† Ø²Ø®Ù….", yt:"https://www.youtube.com/results?search_query=Barbell+Curl+proper+form"},
      {id:"hammer_curl", name:"Ù‡Ø§Ù…Ø± (Hammer Curl)", target:"Ø¨Ø±Ø§ÙƒÙŠØ§Ù„Ø³", split:"biceps", cue:"Ù‚Ø¨Ø¶Ø© Ù…Ø­Ø§ÙŠØ¯Ø©.", yt:"https://www.youtube.com/results?search_query=Hammer+Curl+proper+form"},
      {id:"incline_db_curl", name:"Ø¨Ø§ÙŠ Ù…Ø§Ø¦Ù„ (Incline DB Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ù…Ø¯Ù‰ ÙƒØ§Ù…Ù„.", yt:"https://www.youtube.com/results?search_query=Incline+Dumbbell+Curl+proper+form"},
      {id:"preacher_curl", name:"Ø¨Ø±ÙŠØ´Ø± (Preacher Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ù†Ø²ÙˆÙ„ Ù…ØªØ­ÙƒÙ….", yt:"https://www.youtube.com/results?search_query=Preacher+Curl+proper+form"},
      {id:"cable_curl", name:"Ø¨Ø§ÙŠ ÙƒÙŠØ¨Ù„ (Cable Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ø´Ø¯ Ø«Ø§Ø¨Øª.", yt:"https://www.youtube.com/results?search_query=Cable+Biceps+Curl+proper+form"},
      {id:"concentration_curl", name:"ÙƒÙˆÙ†Ø³Ù†ØªØ±ÙŠØ´Ù† (Concentration Curl)", target:"Ø¨Ø§ÙŠ", split:"biceps", cue:"Ø¹Ø²Ù„ ÙƒØ§Ù…Ù„.", yt:"https://www.youtube.com/results?search_query=Concentration+Curl+proper+form"},

      // Ø±Ø¬ÙˆÙ„ (Legs)
      {id:"squat", name:"Ø³ÙƒÙˆØ§Øª (Back Squat)", target:"ÙƒÙˆØ§Ø¯ + ÙƒÙˆØ±", split:"legs", cue:"ØµØ¯Ø± Ù„Ù„Ø£Ø¹Ù„Ù‰ØŒ Ø±ÙƒØ¨Ø© Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ù….", yt:"https://www.youtube.com/results?search_query=Back+Squat+proper+form"},
      {id:"front_squat", name:"ÙØ±ÙˆÙ†Øª Ø³ÙƒÙˆØ§Øª (Front Squat)", target:"ÙƒÙˆØ§Ø¯ + ÙƒÙˆØ±", split:"legs", cue:"Ù…Ø±ÙÙ‚ Ø¹Ø§Ù„ÙŠØŒ Ø¸Ù‡Ø± Ù…Ø³ØªÙ‚ÙŠÙ….", yt:"https://www.youtube.com/results?search_query=Front+Squat+proper+form"},
      {id:"leg_press", name:"Ù„ÙŠØ¬ Ø¨Ø±Ø³ (Leg Press)", target:"ÙƒÙˆØ§Ø¯/Ø£Ø±Ø¯Ø§Ù", split:"legs", cue:"Ù„Ø§ ØªÙ‚ÙÙ„ Ø§Ù„Ø±ÙƒØ¨Ø©.", yt:"https://www.youtube.com/results?search_query=Leg+Press+proper+form"},
      {id:"rdl", name:"Ø±ÙˆÙ…Ø§Ù†ÙŠØ§Ù† Ø¯ÙŠØ¯Ù„ÙØª (RDL)", target:"Ù‡Ø§Ù…Ø³ØªØ±Ù†Ø¬", split:"legs", cue:"Ù…ÙØµÙ„ Ø§Ù„ÙˆØ±Ùƒ Ù„Ù„Ø®Ù„Ù.", yt:"https://www.youtube.com/results?search_query=Romanian+Deadlift+proper+form"},
      {id:"hip_thrust", name:"Ù‡ÙŠØ¨ Ø«Ø±Ø³Øª (Hip Thrust)", target:"Ø£Ø±Ø¯Ø§Ù", split:"legs", cue:"Ø§Ø¹ØµØ± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.", yt:"https://www.youtube.com/results?search_query=Hip+Thrust+proper+form"},
      {id:"lunge", name:"Ù„Ø§Ù†Ø¬Ø² (Lunge)", target:"ÙƒÙˆØ§Ø¯/Ø£Ø±Ø¯Ø§Ù", split:"legs", cue:"Ø®Ø·ÙˆØ© Ø«Ø§Ø¨ØªØ©.", yt:"https://www.youtube.com/results?search_query=Lunge+proper+form"},
      {id:"bulgarian_split_squat", name:"Ø¨Ù„ØºØ§Ø±ÙŠØ§Ù† (Bulgarian Split Squat)", target:"ÙƒÙˆØ§Ø¯/Ø£Ø±Ø¯Ø§Ù", split:"legs", cue:"Ø±ÙƒØ¨Ø© Ù…ØªØ­ÙƒÙ…Ø©.", yt:"https://www.youtube.com/results?search_query=Bulgarian+Split+Squat+proper+form"},
      {id:"leg_curl", name:"Ù„ÙŠØ¬ ÙƒÙŠØ±Ù„ (Leg Curl)", target:"Ù‡Ø§Ù…Ø³ØªØ±Ù†Ø¬", split:"legs", cue:"ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù†Ø²ÙˆÙ„.", yt:"https://www.youtube.com/results?search_query=Leg+Curl+proper+form"},
      {id:"leg_extension", name:"Ù„ÙŠØ¬ Ø§ÙƒØ³ØªÙ†Ø´Ù† (Leg Extension)", target:"ÙƒÙˆØ§Ø¯", split:"legs", cue:"ØªÙˆÙ‚Ù Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.", yt:"https://www.youtube.com/results?search_query=Leg+Extension+proper+form"},
      {id:"calf_raise", name:"Ø³Ù…Ø§Ù†Ø© (Calf Raise)", target:"Ø³Ù…Ø§Ù†Ø©", split:"legs", cue:"Ù…Ø¯Ù‰ ÙƒØ§Ù…Ù„.", yt:"https://www.youtube.com/results?search_query=Calf+Raise+proper+form"},

      // ÙƒØ§Ø±Ø¯ÙŠÙˆ (Cardio)
      {id:"treadmill_walk", name:"Ù…Ø´ÙŠ Ø³Ø±ÙŠØ¹ (Treadmill/Outdoor)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ø´Ø¯Ø© Zone 2 (ØªÙ‚Ø¯Ø± ØªØªÙƒÙ„Ù… Ø¨ØµØ¹ÙˆØ¨Ø© Ø¨Ø³ÙŠØ·Ø©).", yt:"https://www.youtube.com/results?search_query=Zone+2+cardio+walk"},
      {id:"treadmill_run", name:"Ø¬Ø±ÙŠ (Running)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ø§Ø¨Ø¯Ø£ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª.", yt:"https://www.youtube.com/results?search_query=Running+form+tips"},
      {id:"cycling", name:"Ø¯Ø±Ø§Ø¬Ø© (Cycling)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ø«Ø¨Ø§Øª ÙˆØ¥ÙŠÙ‚Ø§Ø¹ Ù…Ù†Ø§Ø³Ø¨.", yt:"https://www.youtube.com/results?search_query=Stationary+bike+workout"},
      {id:"rowing", name:"ØªØ¬Ø¯ÙŠÙ (Rowing)", target:"Ù‚Ù„Ø¨ + Ø¸Ù‡Ø±", split:"cardio", cue:"ØªÙ‚Ù†ÙŠØ©: Ø¯ÙØ¹ Ø±Ø¬Ù„ Ø«Ù… Ø³Ø­Ø¨.", yt:"https://www.youtube.com/results?search_query=Rowing+machine+proper+form"},
      {id:"elliptical", name:"Ø¥Ù„ÙŠØ¨ØªÙƒØ§Ù„ (Elliptical)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ø´Ø¯Ø© Ù…ØªÙˆØ³Ø·Ø© Ù…Ø³ØªÙ…Ø±Ø©.", yt:"https://www.youtube.com/results?search_query=Elliptical+workout"},
      {id:"stair_climber", name:"Ø³ØªÙŠØ±Ø§Øª/Ø³Ù„Ø§Ù„Ù… (Stair Climber)", target:"Ù‚Ù„Ø¨ + Ø±Ø¬Ù„", split:"cardio", cue:"ÙˆØªÙŠØ±Ø© Ø«Ø§Ø¨ØªØ©.", yt:"https://www.youtube.com/results?search_query=Stair+climber+workout"},
      {id:"jump_rope", name:"Ù†Ø· Ø­Ø¨Ù„ (Jump Rope)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ø§Ø¨Ø¯Ø£ 30â€“60Ø« Ø¬ÙˆÙ„Ø§Øª.", yt:"https://www.youtube.com/results?search_query=Jump+rope+workout"},
      {id:"hiit_intervals", name:"HIIT ÙØªØ±Ø§Øª (Intervals)", target:"Ù‚Ù„Ø¨/Ø­Ø±Ù‚", split:"cardio", cue:"Ù…Ø«Ø§Ù„: 20Ø« Ø³Ø±ÙŠØ¹ + 100Ø« Ø¨Ø·ÙŠØ¡ Ã— 8â€“12.", yt:"https://www.youtube.com/results?search_query=HIIT+intervals+workout"}
    ];

    const SPLIT_LABEL = {
      chest: "ØµØ¯Ø±",
      triceps: "ØªØ±Ø§ÙŠ",
      shoulders: "Ø£ÙƒØªØ§Ù",
      core: "Ù…Ø¹Ø¯Ø©",
      back: "Ø¸Ù‡Ø±ÙŠ",
      biceps: "Ø¨Ø§ÙŠ",
      legs: "Ø±Ø¬ÙˆÙ„",
      cardio: "ÙƒØ§Ø±Ø¯ÙŠÙˆ"
    };


    const FOOD_CATEGORY_LABEL = {
      protein: "Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†",
      carbs: "Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª",
      dairy: "Ø§Ù„Ø£Ù„Ø¨Ø§Ù† ÙˆØ§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø³Ø±ÙŠØ¹",
      fruits: "Ø§Ù„ÙÙˆØ§ÙƒÙ‡",
      veggies: "Ø§Ù„Ø®Ø¶Ø§Ø± ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ§Øª",
      fats: "Ø§Ù„Ø¯Ù‡ÙˆÙ† Ø§Ù„ØµØ­ÙŠØ©"
    };

    const FOOD_LIBRARY = [
      {id:"tuna", name:"ØªÙˆÙ†Ø© Ø¨Ø§Ù„Ù…Ø§Ø¡", cat:"protein", serving:"100 Ø¬Ù…", kcal:116, protein:26, tags:["meal","snack"]},
      {id:"chicken_breast", name:"ØµØ¯Ø± Ø¯Ø¬Ø§Ø¬", cat:"protein", serving:"100 Ø¬Ù…", kcal:165, protein:31, tags:["meal"]},
      {id:"lean_beef", name:"Ù„Ø­Ù… Ù‚Ù„ÙŠÙ„ Ø¯Ù‡Ù†", cat:"protein", serving:"100 Ø¬Ù…", kcal:170, protein:26, tags:["meal"]},
      {id:"fish", name:"Ø³Ù…Ùƒ Ù…Ø´ÙˆÙŠ", cat:"protein", serving:"100 Ø¬Ù…", kcal:128, protein:24, tags:["meal"]},
      {id:"salmon", name:"Ø³Ù„Ù…ÙˆÙ†", cat:"protein", serving:"100 Ø¬Ù…", kcal:208, protein:20, tags:["meal","fat"]},
      {id:"shrimp", name:"Ø±ÙˆØ¨ÙŠØ§Ù†", cat:"protein", serving:"100 Ø¬Ù…", kcal:99, protein:24, tags:["meal"]},
      {id:"turkey", name:"ØªØ±ÙƒÙŠ Ù…Ø¯Ø®Ù†", cat:"protein", serving:"100 Ø¬Ù…", kcal:135, protein:25, tags:["breakfast","snack"]},
      {id:"boiled_eggs", name:"Ø¨ÙŠØ¶ Ù…Ø³Ù„ÙˆÙ‚", cat:"protein", serving:"2 Ø­Ø¨Ø§Øª", kcal:156, protein:12, tags:["breakfast","snack"]},
      {id:"fried_eggs", name:"Ø¨ÙŠØ¶ Ù…Ù‚Ù„ÙŠ", cat:"protein", serving:"2 Ø­Ø¨Ø§Øª", kcal:180, protein:12, tags:["breakfast"]},
      {id:"scrambled_eggs", name:"Ø³ÙƒØ±Ø§Ù…Ø¨Ù„Ø¯ Ø¥ÙŠØº", cat:"protein", serving:"2 Ø­Ø¨Ø§Øª", kcal:170, protein:12, tags:["breakfast"]},
      {id:"egg_whites", name:"Ø¨ÙŠØ§Ø¶ Ø§Ù„Ø¨ÙŠØ¶", cat:"protein", serving:"4 Ø¨ÙŠØ§Ø¶", kcal:68, protein:14, tags:["breakfast"]},
      {id:"foul", name:"ÙÙˆÙ„", cat:"protein", serving:"1 ÙƒÙˆØ¨", kcal:187, protein:13, tags:["breakfast","meal"]},
      {id:"falafel_baked", name:"ÙÙ„Ø§ÙÙ„ Ø®ÙÙŠÙØ©", cat:"protein", serving:"3 Ø­Ø¨Ø§Øª", kcal:170, protein:8, tags:["breakfast"]},
      {id:"cottage_cheese_protein", name:"Ø¬Ø¨Ù† Ù‚Ø±ÙŠØ´ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†", cat:"protein", serving:"100 Ø¬Ù…", kcal:98, protein:11, tags:["breakfast","snack"]},

      {id:"toast_bread", name:"Ø®Ø¨Ø² ØªÙˆØ³Øª", cat:"carbs", serving:"2 Ø´Ø±Ø§Ø¦Ø­", kcal:150, protein:6, tags:["breakfast","meal"]},
      {id:"brown_toast", name:"Ø®Ø¨Ø² ØªÙˆØ³Øª Ø£Ø³Ù…Ø±", cat:"carbs", serving:"2 Ø´Ø±Ø§Ø¦Ø­", kcal:140, protein:7, tags:["breakfast","meal"]},
      {id:"lebanese_bread", name:"Ø®Ø¨Ø² Ù„Ø¨Ù†Ø§Ù†ÙŠ", cat:"carbs", serving:"1 Ø±ØºÙŠÙ ØµØºÙŠØ±", kcal:165, protein:5, tags:["meal"]},
      {id:"tortilla", name:"ØªÙˆØ±ØªÙŠÙ„Ø§", cat:"carbs", serving:"1 Ø­Ø¨Ø©", kcal:140, protein:4, tags:["meal"]},
      {id:"rice", name:"Ø£Ø±Ø²", cat:"carbs", serving:"1 ÙƒÙˆØ¨ Ù…Ø·Ø¨ÙˆØ®", kcal:205, protein:4, tags:["meal"]},
      {id:"brown_rice", name:"Ø£Ø±Ø² Ø¨Ù†ÙŠ", cat:"carbs", serving:"1 ÙƒÙˆØ¨ Ù…Ø·Ø¨ÙˆØ®", kcal:216, protein:5, tags:["meal"]},
      {id:"oats", name:"Ø´ÙˆÙØ§Ù†", cat:"carbs", serving:"40 Ø¬Ù…", kcal:150, protein:5, tags:["breakfast"]},
      {id:"potato", name:"Ø¨Ø·Ø§Ø·Ø³", cat:"carbs", serving:"150 Ø¬Ù…", kcal:130, protein:3, tags:["meal"]},
      {id:"sweet_potato", name:"Ø¨Ø·Ø§Ø·Ø§ Ø­Ù„ÙˆØ©", cat:"carbs", serving:"150 Ø¬Ù…", kcal:135, protein:2, tags:["meal"]},
      {id:"pasta", name:"Ù…ÙƒØ±ÙˆÙ†Ø©", cat:"carbs", serving:"1 ÙƒÙˆØ¨ Ù…Ø·Ø¨ÙˆØ®", kcal:220, protein:8, tags:["meal"]},
      {id:"cornflakes", name:"ÙƒÙˆØ±Ù† ÙÙ„ÙŠÙƒØ³", cat:"carbs", serving:"30 Ø¬Ù…", kcal:114, protein:2, tags:["breakfast"]},
      {id:"granola", name:"Ø¬Ø±Ø§Ù†ÙˆÙ„Ø§", cat:"carbs", serving:"40 Ø¬Ù…", kcal:180, protein:4, tags:["breakfast","snack"]},
      {id:"dates", name:"ØªÙ…Ø±", cat:"carbs", serving:"3 Ø­Ø¨Ø§Øª", kcal:70, protein:1, tags:["snack"]},
      {id:"banana_oat_pancake", name:"Ø¨Ø§Ù†ÙƒÙŠÙƒ Ø´ÙˆÙØ§Ù†", cat:"carbs", serving:"Ù‚Ø·Ø¹ØªØ§Ù†", kcal:220, protein:8, tags:["breakfast"]},

      {id:"greek_yogurt", name:"Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ", cat:"dairy", serving:"170 Ø¬Ù…", kcal:100, protein:17, tags:["breakfast","snack"]},
      {id:"labneh_light", name:"Ù„Ø¨Ù†Ø© Ø®ÙÙŠÙØ©", cat:"dairy", serving:"2 Ù…Ù„Ø¹Ù‚Ø© ÙƒØ¨ÙŠØ±Ø©", kcal:60, protein:4, tags:["breakfast","snack"]},
      {id:"cottage_cheese", name:"Ø¬Ø¨Ù† Ù‚Ø±ÙŠØ´", cat:"dairy", serving:"100 Ø¬Ù…", kcal:98, protein:11, tags:["breakfast","snack"]},
      {id:"milk", name:"Ø­Ù„ÙŠØ¨ Ù‚Ù„ÙŠÙ„ Ø§Ù„Ø¯Ø³Ù…", cat:"dairy", serving:"1 ÙƒÙˆØ¨", kcal:100, protein:8, tags:["breakfast","snack"]},
      {id:"protein_shake", name:"ÙˆØ§ÙŠ Ø¨Ø±ÙˆØªÙŠÙ†", cat:"dairy", serving:"1 Ø³ÙƒÙˆØ¨", kcal:120, protein:24, tags:["snack","post"]},
      {id:"protein_bar", name:"Ø¨Ø±ÙˆØªÙŠÙ† Ø¨Ø§Ø±", cat:"dairy", serving:"1 Ø¨Ø§Ø±", kcal:200, protein:20, tags:["snack"]},
      {id:"lowfat_cheese_slice", name:"Ø¬Ø¨Ù† Ù‚Ù„ÙŠÙ„ Ø§Ù„Ø¯Ø³Ù…", cat:"dairy", serving:"2 Ø´Ø±ÙŠØ­Ø©", kcal:100, protein:10, tags:["breakfast","snack"]},

      {id:"banana", name:"Ù…ÙˆØ²", cat:"fruits", serving:"1 Ø­Ø¨Ø©", kcal:105, protein:1, tags:["breakfast","snack","pre"]},
      {id:"apple", name:"ØªÙØ§Ø­", cat:"fruits", serving:"1 Ø­Ø¨Ø©", kcal:95, protein:0.5, tags:["snack"]},
      {id:"berries", name:"ØªÙˆØª", cat:"fruits", serving:"1 ÙƒÙˆØ¨", kcal:80, protein:1, tags:["breakfast","snack"]},
      {id:"orange", name:"Ø¨Ø±ØªÙ‚Ø§Ù„", cat:"fruits", serving:"1 Ø­Ø¨Ø©", kcal:62, protein:1, tags:["snack"]},
      {id:"watermelon", name:"Ø¨Ø·ÙŠØ®", cat:"fruits", serving:"2 ÙƒÙˆØ¨", kcal:90, protein:2, tags:["snack"]},

      {id:"salad", name:"Ø³Ù„Ø·Ø© Ø®Ø¶Ø±Ø§Ø¡", cat:"veggies", serving:"Ø·Ø¨Ù‚", kcal:35, protein:2, tags:["meal"]},
      {id:"cucumber", name:"Ø®ÙŠØ§Ø±", cat:"veggies", serving:"1 ÙƒÙˆØ¨", kcal:16, protein:1, tags:["meal","snack"]},
      {id:"tomato", name:"Ø·Ù…Ø§Ø·Ù…", cat:"veggies", serving:"1 ÙƒÙˆØ¨", kcal:32, protein:2, tags:["meal"]},
      {id:"broccoli", name:"Ø¨Ø±ÙˆÙƒÙ„ÙŠ", cat:"veggies", serving:"1 ÙƒÙˆØ¨", kcal:55, protein:4, tags:["meal"]},
      {id:"mixed_veg", name:"Ø®Ø¶Ø§Ø± Ù…Ø´ÙƒÙ„Ø©", cat:"veggies", serving:"1 ÙƒÙˆØ¨", kcal:60, protein:3, tags:["meal"]},

      {id:"olive_oil", name:"Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†", cat:"fats", serving:"1 Ù…Ù„Ø¹Ù‚Ø© ÙƒØ¨ÙŠØ±Ø©", kcal:119, protein:0, tags:["meal"]},
      {id:"avocado", name:"Ø£ÙÙˆÙƒØ§Ø¯Ùˆ", cat:"fats", serving:"Ù†ØµÙ Ø­Ø¨Ø©", kcal:120, protein:2, tags:["meal","snack"]},
      {id:"almonds", name:"Ù„ÙˆØ²", cat:"fats", serving:"15 Ø­Ø¨Ø©", kcal:105, protein:4, tags:["snack"]},
      {id:"peanut_butter", name:"Ø²Ø¨Ø¯Ø© ÙÙˆÙ„ Ø³ÙˆØ¯Ø§Ù†ÙŠ", cat:"fats", serving:"1 Ù…Ù„Ø¹Ù‚Ø© ÙƒØ¨ÙŠØ±Ø©", kcal:95, protein:4, tags:["breakfast","snack"]},
      {id:"walnuts", name:"Ø¬ÙˆØ²", cat:"fats", serving:"15 Ø¬Ù…", kcal:98, protein:2, tags:["snack"]}
    ];


    const KEY_PROFILE_BASE = "fit_profile_auth_v1";
    const KEY_LOG_BASE = "fit_log_auth_v1";
    const KEY_DIET_BASE = "fit_diet_auth_v1";

    const cloud = {
      enabled: false,
      db: null,
      auth: null,
      user: null,
      docRef: null,
      status: "local", // local | online | syncing | error
      lastError: ""
    };
    function activeUid(){ return cloud.user?.uid || "guest"; }
    function profileKey(){ return `${KEY_PROFILE_BASE}_${activeUid()}`; }
    function logKey(){ return `${KEY_LOG_BASE}_${activeUid()}`; }
    function dietKey(){ return `${KEY_DIET_BASE}_${activeUid()}`; }

    function readJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : fallback;
      }catch{
        return fallback;
      }
    }
    function writeJSON(key, value){
      localStorage.setItem(key, JSON.stringify(value));
    }
    function clearCurrentLocalData(){
      localStorage.removeItem(profileKey());
      localStorage.removeItem(logKey());
      localStorage.removeItem(dietKey());
    }

    function isProfileComplete(p){
      return !!(p &&
        Number.isFinite(Number(p.age)) && Number(p.age) > 0 &&
        Number.isFinite(Number(p.height)) && Number(p.height) > 0 &&
        Number.isFinite(Number(p.weight)) && Number(p.weight) > 0 &&
        p.sex && p.activity && p.goal
      );
    }

    function updateSaveState(tempText){
      const el = $("saveState");
      if(!el) return;
      if(tempText){ el.textContent = tempText; return; }

      if(!cloud.enabled){ el.textContent = "Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ"; return; }
      if(!cloud.user){ el.textContent = "Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©"; return; }

      if(cloud.status === "syncing") el.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebaseâ€¦";
      else if(cloud.status === "online") el.textContent = "Ù…ØªØµÙ„ Ø¨Ù€ Firebase âœ…";
      else if(cloud.status === "error") el.textContent = "Ø®Ø·Ø£ Ù…Ø²Ø§Ù…Ù†Ø© â€” Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹";
      else el.textContent = "Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ";
    }

    function setPillMessage(id, msg, isError=false){
      const el = $(id);
      if(!el) return;
      if(!msg){
        el.hidden = true;
        el.textContent = "";
        return;
      }
      el.hidden = false;
      el.textContent = msg;
      el.style.color = isError ? "var(--bad)" : "var(--text)";
      el.style.borderColor = isError ? "rgba(255,124,134,.35)" : "var(--line)";
      el.style.background = isError ? "rgba(255,124,134,.08)" : "rgba(95,207,167,.07)";
    }

    function authErrorText(err){
      const code = err?.code || "";
      if(code.includes("invalid-email")) return "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.";
      if(code.includes("user-not-found")) return "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯.";
      if(code.includes("wrong-password") || code.includes("invalid-credential")) return "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
      if(code.includes("email-already-in-use")) return "Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹.";
      if(code.includes("weak-password")) return "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© (Ø§Ø¬Ø¹Ù„Ù‡Ø§ 6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±).";
      if(code.includes("too-many-requests")) return "Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.";
      if(code.includes("network-request-failed")) return "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
      if(code.includes("requires-recent-login")) return "ÙŠÙ„Ø²Ù… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ«. Ø³Ø¬Ù‘Ù„ Ø®Ø±ÙˆØ¬ Ø«Ù… Ø§Ø¯Ø®Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
      if(code.includes("permission-denied")) return "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Firestore (Ø±Ø§Ø¬Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Rules).";
      return err?.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.";
    }

    function setMainVisibility(showApp){
      $("authPanel").hidden = !!showApp;
      $("appMain").hidden = !showApp;
      $("userBar").hidden = !showApp;
    }

    function refreshUserBadge(){
      const user = cloud.user;
      const nameText = $("userNameText");
      const avatarText = $("userAvatarText");
      const avatarImg = $("userAvatarImg");

      if(!user){
        if(nameText) nameText.textContent = "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
        if(avatarText) avatarText.textContent = "ØŸ";
        if(avatarImg){ avatarImg.hidden = true; avatarImg.removeAttribute("src"); }
        return;
      }

      const label = (user.displayName && user.displayName.trim()) ? user.displayName.trim() : (user.email || "Ù…Ø³ØªØ®Ø¯Ù…");
      if(nameText) nameText.textContent = label;

      const photo = user.photoURL || "";
      if(photo && avatarImg){
        avatarImg.src = photo;
        avatarImg.hidden = false;
        if(avatarText) avatarText.textContent = "";
      }else{
        if(avatarImg){ avatarImg.hidden = true; avatarImg.removeAttribute("src"); }
        const initial = (label || "ØŸ").trim()[0] || "ØŸ";
        if(avatarText) avatarText.textContent = initial;
      }
    }

    function setProfileEditor(showEditor){
      const form = $("profileFormSection");
      const hint = $("profileLockHint");
      const title = $("profileCardTitle");

      if(form) form.hidden = !showEditor;

      const p = loadProfile();
      const complete = isProfileComplete(p);

      if(showEditor){
        if(hint) hint.hidden = true;
        if(title){
          if(cloud.user) title.textContent = complete ? "Ù¡) ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ + Ø§Ù„Ø­Ø³Ø¨Ø©" : "Ù¡) Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)";
          else title.textContent = "Ù¡) Ø¨ÙŠØ§Ù†Ø§ØªÙƒ + Ø§Ù„Ø­Ø³Ø¨Ø©";
        }
      }else{
        if(title) title.textContent = "Ù¡) Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ + Ø§Ù„Ø­Ø³Ø¨Ø©";
        if(hint) hint.hidden = false;
      }
    }

    async function initFirebaseServices(){
      try{
        const app = initializeApp(firebaseConfig);
        try{
          if(await analyticsSupported()){
            getAnalytics(app);
          }
        }catch(_e){}
        cloud.db = getFirestore(app);
        cloud.auth = getAuth(app);
        await setPersistence(cloud.auth, browserLocalPersistence);
        cloud.enabled = true;
        cloud.status = "local";
      }catch(err){
        cloud.enabled = false;
        cloud.status = "error";
        cloud.lastError = err?.message || String(err);
        console.warn("Firebase init failed:", err);
      }
      updateSaveState();
    }

    let syncTimer = null;
    function scheduleCloudSync(){
      if(!cloud.enabled || !cloud.user || !cloud.docRef) return;
      clearTimeout(syncTimer);
      syncTimer = setTimeout(() => {
        syncToCloud().catch(err => {
          cloud.status = "error";
          cloud.lastError = err?.message || String(err);
          updateSaveState();
          console.warn("Cloud sync failed:", err);
        });
      }, 350);
    }

    async function syncToCloud(){
      if(!cloud.enabled || !cloud.user || !cloud.docRef) return;
      cloud.status = "syncing";
      updateSaveState();

      const profile = readJSON(profileKey(), {});
      const log = readJSON(logKey(), []);
      const dietPrefs = readJSON(dietKey(), { selected: [], updatedAtClient: 0 });

      const payload = {
        uid: cloud.user.uid,
        email: cloud.user.email || "",
        profile,
        log,
        dietPrefs,
        profileCompleted: isProfileComplete(profile),
        updatedAtClient: Date.now(),
        updatedAt: serverTimestamp()
      };

      await setDoc(cloud.docRef, payload, { merge: true });
      cloud.status = "online";
      updateSaveState();
    }

    async function loadFromCloudForUser(user){
      if(!cloud.enabled || !user || !cloud.docRef) return false;
      try{
        cloud.status = "syncing";
        updateSaveState();

        const snap = await getDoc(cloud.docRef);
        if(snap.exists()){
          const data = snap.data() || {};
          if(data.profile && typeof data.profile === "object") writeJSON(profileKey(), data.profile);
          if(Array.isArray(data.log)) writeJSON(logKey(), data.log);
          if(data.dietPrefs && typeof data.dietPrefs === "object") writeJSON(dietKey(), data.dietPrefs);
        }

        cloud.status = "online";
        updateSaveState();
        return true;
      }catch(err){
        cloud.status = "error";
        cloud.lastError = err?.message || String(err);
        updateSaveState();
        console.warn("Cloud load failed:", err);
        return false;
      }
    }

    const loadProfile = () => readJSON(profileKey(), {});
    const saveProfile = (p) => { writeJSON(profileKey(), p); scheduleCloudSync(); };
    const loadLog = () => readJSON(logKey(), []);
    const saveLog = (rows) => { writeJSON(logKey(), rows); scheduleCloudSync(); };
    const loadDietPrefs = () => readJSON(dietKey(), { selected: [], updatedAtClient: 0 });
    const saveDietPrefs = (prefs) => { writeJSON(dietKey(), prefs); scheduleCloudSync(); };

    function calcBMR({sex, weight, height, age}){
      const base = 10*weight + 6.25*height - 5*age;
      return sex === "female" ? (base - 161) : (base + 5);
    }
    function goalCalories(tdee, goal){
      if(goal === "cut") return tdee * 0.80;
      if(goal === "bulk") return tdee * 1.10;
      if(goal === "recomp") return tdee * 1.00;
      return tdee;
    }
    function proteinRangePerKg(goal){
      if(goal === "cut") return [2.2, 2.4];
      if(goal === "bulk") return [2.0, 2.2];
      if(goal === "recomp") return [2.0, 2.2];
      return [1.6, 2.0];
    }
    function applySafetyFloors(cals, sex){
      const floor = (sex === "female") ? 1200 : 1500;
      return Math.max(cals, floor);
    }

    function updateAdvice(){
      const goal = $("goal").value;
      const cardioPref = $("cardioPref").value;

      const cardio = [];
      if(cardioPref === "none"){
        cardio.push("Ø¥Ø°Ø§ Ù‡Ø¯ÙÙƒ ØªÙ†Ø´ÙŠÙ: Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø®Ø·ÙˆØ§Øª) Ø£ÙˆÙ„ÙˆÙŠØ©ØŒ ÙˆÙƒØ§Ø±Ø¯ÙŠÙˆ Ø§Ø®ØªÙŠØ§Ø±ÙŠ.");
      } else if(cardioPref === "light"){
        cardio.push("2â€“3 Ø¬Ù„Ø³Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ã— 20â€“30 Ø¯Ù‚ÙŠÙ‚Ø©.");
        cardio.push("Ø£ÙØ¶Ù„ ØªÙˆÙ‚ÙŠØª: Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø£Ùˆ ÙÙŠ ÙŠÙˆÙ… Ù…Ù†ÙØµÙ„.");
      } else if(cardioPref === "moderate"){
        cardio.push("3â€“4 Ø¬Ù„Ø³Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ã— 25â€“40 Ø¯Ù‚ÙŠÙ‚Ø©.");
        cardio.push("Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø´Ø¯Ø© Ù…ØªÙˆØ³Ø·Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø§ÙÙŠ.");
      } else {
        cardio.push("4â€“6 Ø¬Ù„Ø³Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ã— 30â€“45 Ø¯Ù‚ÙŠÙ‚Ø©.");
        cardio.push("Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„ØªØ¹Ø¨ØŒ ÙˆÙ‚Ù„Ù„ Ø­Ø¬Ù… Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ø²Ù….");
      }

      const cardioTypes = [
        "LISS: Ù…Ø´ÙŠ Ø³Ø±ÙŠØ¹/Ø¯Ø±Ø§Ø¬Ø© Ø«Ø§Ø¨ØªØ© Ø´Ø¯Ø© Ø®ÙÙŠÙØ©-Ù…ØªÙˆØ³Ø·Ø©.",
        "HIIT (Ø§Ø®ØªÙŠØ§Ø±ÙŠ): 8â€“12 Ø¬ÙˆÙ„Ø© (20Ø« Ø³Ø±ÙŠØ¹ + 100Ø« Ø¨Ø·ÙŠØ¡) Ù…Ø±Ø©/Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¨ØªØ¯Ø¦.",
        "Zone 2: Ù†Ø´Ø§Ø· Ù…Ø³ØªÙ…Ø± ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø¹Ù‡ Ø§Ù„ÙƒÙ„Ø§Ù… Ø¨ØµØ¹ÙˆØ¨Ø© Ø¨Ø³ÙŠØ·Ø©."
      ];

      if(goal === "bulk") cardioTypes.push("ÙÙŠ Ø§Ù„ØªØ¶Ø®ÙŠÙ…: Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„ÙŠØ§Ù‚Ø© ÙˆØ§Ù„Ù‚Ù„Ø¨ (Ù„Ø§ ØªØ¨Ø§Ù„Øº Ø­ØªÙ‰ Ù„Ø§ ØªÙ‚Ù„Ù„ ÙØ§Ø¦Ø¶ Ø§Ù„Ø³Ø¹Ø±Ø§Øª).");
      if(goal === "cut") cardioTypes.push("ÙÙŠ Ø§Ù„ØªÙ†Ø´ÙŠÙ: Ø§Ø¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ§Øª Ø£ÙƒØ«Ø± Ø«Ù… Ø£Ø¶Ù ÙƒØ§Ø±Ø¯ÙŠÙˆ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù‚Øµ Ø³Ø¹Ø±Ø§Øª ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹.");

      $("cardioAdvice").innerHTML = "<ul style='margin:8px 0 0; padding-right:18px;'>" +
        cardio.map(x=>`<li>${x}</li>`).join("") +
        "<li><b>Ø£Ù†ÙˆØ§Ø¹ Ù…Ù†Ø§Ø³Ø¨Ø©:</b><ul style='margin:6px 0 0; padding-right:18px;'>" +
        cardioTypes.map(x=>`<li>${x}</li>`).join("") +
        "</ul></li></ul>";

      const food = [];
      food.push("Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø¨Ø±ÙˆØªÙŠÙ† Ø¹Ø§Ù„ÙŠ: Ø¯Ø¬Ø§Ø¬/ØªÙˆÙ†Ø©/Ù„Ø­Ù… Ù‚Ù„ÙŠÙ„ Ø¯Ù‡Ù†/Ø¨ÙŠØ¶/Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ/ÙˆØ§ÙŠ Ø¨Ø±ÙˆØªÙŠÙ†.");
      food.push("ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ù†Ø¸ÙŠÙØ© Ø­ÙˆÙ„ Ø§Ù„ØªÙ…Ø±ÙŠÙ†: Ø±Ø²/Ø´ÙˆÙØ§Ù†/Ø¨Ø·Ø§Ø·Ø³/Ø®Ø¨Ø² Ù‚Ù…Ø­.");
      food.push("Ø¯Ù‡ÙˆÙ† ØµØ­ÙŠØ© Ø¨ÙƒÙ…ÙŠØ© Ù…Ø­Ø³ÙˆØ¨Ø©: Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†/Ø£ÙÙˆÙƒØ§Ø¯Ùˆ/Ù…ÙƒØ³Ø±Ø§Øª.");
      food.push("Ø®Ø¶Ø§Ø± + Ù…Ø§Ø¡ + Ù…Ù„Ø­ ÙƒÙØ§ÙŠØ© (Ø®ØµÙˆØµØ§Ù‹ Ù…Ø¹ Ø§Ù„ØªØ¹Ø±Ù‚).");

      if(goal === "cut"){
        food.push("Ø§Ø®ØªØ± Ø£Ø·Ø¹Ù…Ø© Ù…Ø´Ø¨Ø¹Ø©: Ø´ÙˆØ±Ø¨Ø©/Ø®Ø¶Ø§Ø±/Ø¨Ø±ÙˆØªÙŠÙ†ØŒ ÙˆÙ‚Ù„Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø³ÙƒØ±ÙŠØ©.");
      } else if(goal === "bulk"){
        food.push("Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø©: Ø±Ø²/Ù…ÙƒØ±ÙˆÙ†Ø©/Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†/Ù…ÙƒØ³Ø±Ø§Øª/Ø³Ù…ÙˆØ«ÙŠ Ø¨Ø±ÙˆØªÙŠÙ†.");
      } else if(goal === "recomp"){
        food.push("Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø«Ø¨Ø§Øª Ø¹Ø§Ù„ÙŠ: Ø¨Ø±ÙˆØªÙŠÙ† Ø«Ø§Ø¨Øª + Ø®Ø·ÙˆØ§Øª ÙŠÙˆÙ…ÙŠØ© + Ø£ÙˆØ²Ø§Ù† Ù…ØªØ¯Ø±Ø¬Ø©.");
      }

      $("foodAdvice").innerHTML = "<ul style='margin:8px 0 0; padding-right:18px;'>" +
        food.map(x=>`<li>${x}</li>`).join("") + "</ul>";
    }

    function fillProfileForm(p){
      $("name").value = p.name ?? "";
      $("sex").value = p.sex ?? "male";
      $("age").value = p.age ?? "";
      $("height").value = p.height ?? "";
      $("weight").value = p.weight ?? "";
      $("activity").value = p.activity ?? "1.55";
      $("goal").value = p.goal ?? "recomp";
      $("cardioPref").value = p.cardioPref ?? "light";
    }
    function readProfileForm(){
      return {
        name: $("name").value.trim(),
        sex: $("sex").value,
        age: Number($("age").value),
        height: Number($("height").value),
        weight: Number($("weight").value),
        activity: Number($("activity").value),
        goal: $("goal").value,
        cardioPref: $("cardioPref").value
      };
    }

    
    function generateMealPlan(cals, proLo, proHi, goal){
      const kcal = Math.round(cals);
      const pLo = Math.round(proLo);
      const pHi = Math.round(proHi);

      const goalHint = (goal === "bulk")
        ? "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¶Ø¹ÙŠÙ/Ø¬ÙˆØ¹: Ø²Ø¯ 100â€“200 Ø³Ø¹Ø±Ø© (Ø±Ø²/Ø¨Ø·Ø§Ø·Ø³/Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†)."
        : (goal === "cut")
          ? "Ù„Ù„ØªÙ†Ø´ÙŠÙ: Ø«Ø¨Øª Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† ÙˆØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¶Ø§Ø± ÙˆØ§Ù„Ù…Ø§Ø¡ØŒ ÙˆØ²Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª."
          : (goal === "recomp")
            ? "Ù„Ù€ Recomp: Ø«Ø¨Øª Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ù‚Ø±ÙŠØ¨ Ù…Ù† TDEEØŒ ÙˆØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ØªØ¯Ø±Ø¬ Ø¨Ø§Ù„Ø£ÙˆØ²Ø§Ù†."
            : "Ù„Ù„ØªØ«Ø¨ÙŠØª: Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ±Ø§Ù‚Ø¨ Ø§Ù„ÙˆØ²Ù† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.";

      const plan = `
        <div style="line-height:1.8;">
          <div class="badge">Ø§Ù„Ø³Ø¹Ø±Ø§Øª: <b>${kcal}</b> kcal â€¢ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†: <b>${pLo}â€“${pHi}</b> g</div>
          <div style="margin-top:10px;">
            <b>Ø§Ù„ÙŠÙˆÙ… 1</b><br>
            ÙØ·ÙˆØ±: 3 Ø¨ÙŠØ¶ + 40 Ø¬Ù… Ø´ÙˆÙØ§Ù†<br>
            Ø³Ù†Ø§Ùƒ: Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ + ÙØ§ÙƒÙ‡Ø©<br>
            ØºØ¯Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + 120 Ø¬Ù… Ø±Ø² + Ø³Ù„Ø·Ø©<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ Ù„Ø§ÙŠØª<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… ØªÙˆÙ†Ø© + Ø®Ø¶Ø§Ø±<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 2</b><br>
            ÙØ·ÙˆØ±: 2 Ø¨ÙŠØ¶ + 150 Ø¬Ù… Ø¨ÙŠØ§Ø¶ + Ø´Ø±ÙŠØ­Ø© Ø®Ø¨Ø² Ø£Ø³Ù…Ø±<br>
            Ø³Ù†Ø§Ùƒ: Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ<br>
            ØºØ¯Ø§Ø¡: 170 Ø¬Ù… Ù„Ø­Ù… Ù‚Ù„ÙŠÙ„ Ø¯Ù‡Ù† + 150 Ø¬Ù… Ø¨Ø·Ø§Ø·Ø³ + Ø³Ù„Ø·Ø©<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ + 10 Ø¬Ù… Ù…ÙƒØ³Ø±Ø§Øª<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + Ø®Ø¶Ø§Ø±<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 3</b><br>
            ÙØ·ÙˆØ±: 50 Ø¬Ù… Ø´ÙˆÙØ§Ù† + Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ + 10 Ø¬Ù… Ø²Ø¨Ø¯Ø© ÙÙˆÙ„ Ø³ÙˆØ¯Ø§Ù†ÙŠ<br>
            Ø³Ù†Ø§Ùƒ: 2 Ø¨ÙŠØ¶<br>
            ØºØ¯Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + 120 Ø¬Ù… Ø±Ø²<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… ØªÙˆÙ†Ø©/Ø¯Ø¬Ø§Ø¬ + Ø®Ø¶Ø§Ø±<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 4</b><br>
            ÙØ·ÙˆØ±: Ø£ÙˆÙ…Ù„ÙŠØª (3 Ø¨ÙŠØ¶) + Ø®Ø¶Ø§Ø±<br>
            Ø³Ù†Ø§Ùƒ: Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ<br>
            ØºØ¯Ø§Ø¡: 180 Ø¬Ù… Ø³Ù…Ùƒ (Ø£Ùˆ 150 Ø¬Ù… Ø³Ù…Ùƒ Ø£Ø¨ÙŠØ¶) + 100 Ø¬Ù… Ø±Ø²<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + Ø³Ù„Ø·Ø© (+ Ù…Ù„Ø¹Ù‚Ø© ØµØºÙŠØ±Ø© Ø²ÙŠØª Ø²ÙŠØªÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª)<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 5</b><br>
            ÙØ·ÙˆØ±: 40 Ø¬Ù… Ø´ÙˆÙØ§Ù† + Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ + Ù…ÙˆØ²Ø© ØµØºÙŠØ±Ø©<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ<br>
            ØºØ¯Ø§Ø¡: 170 Ø¬Ù… Ù„Ø­Ù… Ù‚Ù„ÙŠÙ„ Ø¯Ù‡Ù† (Ø£Ùˆ 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬) + Ø±Ø²/Ø¨Ø·Ø§Ø·Ø³ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±Ø¬Øª<br>
            Ø³Ù†Ø§Ùƒ: ÙØ§ÙƒÙ‡Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… ØªÙˆÙ†Ø© + Ø®Ø¶Ø§Ø±<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 6</b><br>
            ÙØ·ÙˆØ±: 2 Ø¨ÙŠØ¶ + 150 Ø¬Ù… Ø¨ÙŠØ§Ø¶ + Ø®Ø¶Ø§Ø±<br>
            Ø³Ù†Ø§Ùƒ: Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ<br>
            ØºØ¯Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + 150 Ø¬Ù… Ø¨Ø·Ø§Ø·Ø³ + Ø³Ù„Ø·Ø©<br>
            Ø³Ù†Ø§Ùƒ: 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ + 10 Ø¬Ù… Ù…ÙƒØ³Ø±Ø§Øª<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… Ø¯Ø¬Ø§Ø¬/ØªÙˆÙ†Ø© + Ø®Ø¶Ø§Ø±<br><br>

            <b>Ø§Ù„ÙŠÙˆÙ… 7 (Ø®ÙÙŠÙ ÙƒØ±Ø¨)</b><br>
            ÙØ·ÙˆØ±: 3 Ø¨ÙŠØ¶ + 200 Ø¬Ù… Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ<br>
            Ø³Ù†Ø§Ùƒ: Ø³ÙƒÙˆØ¨ ÙˆØ§ÙŠ<br>
            ØºØ¯Ø§Ø¡: 170 Ø¬Ù… Ø¯Ø¬Ø§Ø¬ + Ø³Ù„Ø·Ø© ÙƒØ¨ÙŠØ±Ø© (+ Ù…Ù„Ø¹Ù‚Ø© ØµØºÙŠØ±Ø© Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†)<br>
            Ø³Ù†Ø§Ùƒ: ÙØ§ÙƒÙ‡Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª)<br>
            Ø¹Ø´Ø§Ø¡: 150 Ø¬Ù… Ø³Ù…Ùƒ/ØªÙˆÙ†Ø© + Ø®Ø¶Ø§Ø±<br><br>

            <span class="muted">${goalHint}</span>
          </div>
        </div>
      `;

      const out = document.getElementById("mealPlanOut");
      if(out) out.innerHTML = plan;
    }


    function buildDietChoicePlanHTML(selectedIds){
      const selected = Array.isArray(selectedIds)
        ? selectedIds.map(id => FOOD_LIBRARY.find(item => item.id === id)).filter(Boolean)
        : [];

      if(!selected.length){
        return '<span class="muted">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨ÙƒØŒ Ø«Ù… Ø§Ø¶ØºØ· "Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø·Ø¹Ù…Ø©" Ù„ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø§Ù‚ØªØ±Ø§Ø­ Ø¹Ù…Ù„ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹.</span>';
      }

      const byCat = {
        protein: selected.filter(item => item.cat === 'protein'),
        carbs: selected.filter(item => item.cat === 'carbs'),
        dairy: selected.filter(item => item.cat === 'dairy'),
        fruits: selected.filter(item => item.cat === 'fruits'),
        veggies: selected.filter(item => item.cat === 'veggies'),
        fats: selected.filter(item => item.cat === 'fats')
      };

      const names = (items, fallback, limit=4) => {
        const list = (items || []).slice(0, limit).map(item => item.name);
        return list.length ? list.join(' / ') : fallback;
      };

      const breakfastProtein = [...byCat.protein.filter(item => item.tags.includes('breakfast')), ...byCat.dairy.filter(item => item.tags.includes('breakfast') || item.tags.includes('snack'))];
      const breakfastCarbs = byCat.carbs.filter(item => item.tags.includes('breakfast'));
      const mainProtein = [...byCat.protein.filter(item => item.tags.includes('meal')), ...byCat.dairy.filter(item => item.tags.includes('post'))];
      const mainCarbs = byCat.carbs.filter(item => item.tags.includes('meal') || item.tags.includes('snack'));
      const snackChoices = [...byCat.dairy.filter(item => item.tags.includes('snack') || item.tags.includes('post')), ...byCat.fruits, ...byCat.fats.filter(item => item.tags.includes('snack')), ...byCat.protein.filter(item => item.tags.includes('snack'))];
      const vegChoices = byCat.veggies;
      const fatChoices = byCat.fats;

      const selectedCount = selected.length;
      const groupsCount = Object.values(byCat).filter(arr => arr.length).length;
      const selectedKcal = selected.reduce((sum, item) => sum + (Number(item.kcal) || 0), 0);
      const selectedProtein = Math.round(selected.reduce((sum, item) => sum + (Number(item.protein) || 0), 0) * 10) / 10;

      return `
        <div><strong>Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</strong> ${selectedCount} ØµÙ†ÙÙ‹Ø§ Ù…Ù† ${groupsCount} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¯ÙˆÙŠØ±Ù‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª.<br><span class="muted">Ù…Ø¬Ù…ÙˆØ¹ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: ${selectedKcal} Ø³Ø¹Ø±Ø© â€¢ ${selectedProtein} Ø¬Ù… Ø¨Ø±ÙˆØªÙŠÙ†</span></div>
        <div style="margin-top:8px;"><strong>ÙØ·ÙˆØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚:</strong> 1 Ù…ØµØ¯Ø± Ø¨Ø±ÙˆØªÙŠÙ† Ù…Ù† (${names(breakfastProtein, 'Ø¨ÙŠØ¶ / Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ / Ø¬Ø¨Ù† Ù‚Ø±ÙŠØ´', 3)}) + 1 ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ù…Ù† (${names(breakfastCarbs, 'Ø´ÙˆÙØ§Ù† / Ø®Ø¨Ø² ØªÙˆØ³Øª', 3)})${byCat.fruits.length ? ` + ÙØ§ÙƒÙ‡Ø© Ù…Ù† (${names(byCat.fruits, 'ÙØ§ÙƒÙ‡Ø©', 2)})` : ''}.</div>
        <div style="margin-top:6px;"><strong>Ø³Ù†Ø§Ùƒ:</strong> Ø§Ø®ØªØ± 1â€“2 Ù…Ù† (${names(snackChoices, 'Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ / ÙˆØ§ÙŠ Ø¨Ø±ÙˆØªÙŠÙ† / ÙØ§ÙƒÙ‡Ø© / Ù…ÙƒØ³Ø±Ø§Øª', 5)}).</div>
        <div style="margin-top:6px;"><strong>ØºØ¯Ø§Ø¡:</strong> 1 Ø¨Ø±ÙˆØªÙŠÙ† Ù…Ù† (${names(mainProtein, 'Ø¯Ø¬Ø§Ø¬ / ØªÙˆÙ†Ø© / Ù„Ø­Ù…', 4)}) + 1 ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ù…Ù† (${names(mainCarbs, 'Ø£Ø±Ø² / Ø¨Ø·Ø§Ø·Ø³ / Ø®Ø¨Ø² Ù„Ø¨Ù†Ø§Ù†ÙŠ', 4)})${vegChoices.length ? ` + Ø®Ø¶Ø§Ø± Ù…Ù† (${names(vegChoices, 'Ø³Ù„Ø·Ø© / Ø®ÙŠØ§Ø± / Ø·Ù…Ø§Ø·Ù…', 3)})` : ''}.</div>
        <div style="margin-top:6px;"><strong>Ø¹Ø´Ø§Ø¡:</strong> Ø§Ø®ØªØ± Ø¨Ø±ÙˆØªÙŠÙ† Ø£Ø®Ù Ù…Ù† (${names(mainProtein, 'ØªÙˆÙ†Ø© / Ø¯Ø¬Ø§Ø¬ / Ø¨ÙŠØ¶', 3)})${vegChoices.length ? ` + Ø®Ø¶Ø§Ø± Ù…Ù† (${names(vegChoices, 'Ø³Ù„Ø·Ø© / Ø®Ø¶Ø§Ø±', 2)})` : ''}${fatChoices.length ? ` + Ø¥Ø¶Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ù…Ù† (${names(fatChoices, 'Ø²ÙŠØª Ø²ÙŠØªÙˆÙ† / Ø£ÙÙˆÙƒØ§Ø¯Ùˆ', 2)})` : ''}.</div>
        <div style="margin-top:8px;" class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚ØªØŒ ÙˆØ³ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ø­ÙÙˆØ¸Ø§Ù‹ Ù„Ùƒ.</div>
      `;
    }

    function renderBodyStatsPanel(p){
      const weightEl = $("weightOut"), heightEl = $("heightOut"), bmiEl = $("bmiOut"), targetEl = $("weightTargetOut");
      const weightNote = $("weightNote"), heightNote = $("heightNote"), bmiNote = $("bmiNote"), targetNote = $("weightTargetNote");
      const age = Number(p.age);
      const h = Number(p.height);
      const w = Number(p.weight);
      const hM = Number.isFinite(h) && h > 0 ? (h / 100) : NaN;

      if(weightEl) weightEl.textContent = Number.isFinite(w) && w > 0 ? `${Math.round(w*10)/10} ÙƒØ¬Ù…` : "â€”";
      if(heightEl) heightEl.textContent = Number.isFinite(h) && h > 0 ? `${Math.round(h*10)/10} Ø³Ù…` : "â€”";
      if(weightNote) weightNote.textContent = Number.isFinite(age) && age > 0 ? `Ø§Ù„Ø¹Ù…Ø±: ${Math.round(age)} Ø³Ù†Ø©` : "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ø± Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ.";
      if(heightNote) heightNote.textContent = p.activity ? `Ø§Ù„Ù†Ø´Ø§Ø·: ${$("activity")?.selectedOptions?.[0]?.textContent || "â€”"}` : "Ø³ÙŠØ¸Ù‡Ø± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø· Ù‡Ù†Ø§.";

      if(!Number.isFinite(w) || w <= 0 || !Number.isFinite(hM) || hM <= 0){
        if(bmiEl) bmiEl.textContent = "â€”";
        if(bmiNote) bmiNote.textContent = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù† Ù„Ø­Ø³Ø§Ø¨ BMI.";
        if(targetEl) targetEl.textContent = "â€”";
        if(targetNote) targetNote.textContent = "ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ BMI Ø§Ù„ØµØ­ÙŠ.";
        return;
      }

      const bmi = w / (hM*hM);
      const bmiRounded = (Math.round(bmi * 10) / 10).toFixed(1);
      let bmiClass = "Ø·Ø¨ÙŠØ¹ÙŠ";
      if(bmi < 18.5) bmiClass = "Ù†Ù‚Øµ ÙˆØ²Ù†";
      else if(bmi < 25) bmiClass = "Ø·Ø¨ÙŠØ¹ÙŠ";
      else if(bmi < 30) bmiClass = "Ø²ÙŠØ§Ø¯Ø© ÙˆØ²Ù†";
      else bmiClass = "Ø³Ù…Ù†Ø©";

      const healthyMin = 18.5 * hM * hM;
      const healthyMax = 24.9 * hM * hM;
      const suggested = 22 * hM * hM;
      const diff = w - suggested;
      const diffAbs = Math.abs(Math.round(diff * 10) / 10);
      const diffText = diffAbs < 0.1 ? "Ø£Ù†Øª Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ù‚ØªØ±Ø­." : (diff > 0 ? `ÙØ±Ù‚ ØªÙ‚Ø±ÙŠØ¨ÙŠ: -${diffAbs} ÙƒØ¬Ù…` : `ÙØ±Ù‚ ØªÙ‚Ø±ÙŠØ¨ÙŠ: +${diffAbs} ÙƒØ¬Ù…`);

      if(bmiEl) bmiEl.textContent = `${bmiRounded}`;
      if(bmiNote) bmiNote.textContent = `ØªØµÙ†ÙŠÙ BMI: ${bmiClass}`;
      if(targetEl) targetEl.textContent = `${Math.round(suggested*10)/10} ÙƒØ¬Ù…`;
      if(targetNote) targetNote.textContent = `Ù†Ø·Ø§Ù‚ ØµØ­ÙŠ ØªÙ‚Ø±ÙŠØ¨ÙŠ: ${Math.round(healthyMin*10)/10} â€“ ${Math.round(healthyMax*10)/10} ÙƒØ¬Ù… â€¢ ${diffText}`;
    }

    function calcAndRender(){
      const p = readProfileForm();
      renderBodyStatsPanel(p);
      const valid = Number.isFinite(p.age) && Number.isFinite(p.height) && Number.isFinite(p.weight) && p.age>0 && p.height>0 && p.weight>0;

      if(!valid){
        $("bmrOut").textContent = "â€”";
        $("tdeeOut").textContent = "â€”";
        $("calOut").textContent = "â€”";
        $("proOut").textContent = "â€”";
        $("calNote").textContent = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ø±/Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„ÙˆØ²Ù† Ø£ÙˆÙ„Ø§Ù‹.";
        $("proNote").textContent = "â€”";
        updateAdvice();
        return;
      }

      const bmr = calcBMR(p);
      const tdee = bmr * p.activity;

      let cals = goalCalories(tdee, p.goal);
      if(p.goal === "cut") cals = applySafetyFloors(cals, p.sex);

      const [lo, hi] = proteinRangePerKg(p.goal);
      const proLo = p.weight * lo;
      const proHi = p.weight * hi;

      $("bmrOut").textContent = fmt(bmr);
      $("tdeeOut").textContent = fmt(tdee);
      $("calOut").textContent = fmt(cals);
      $("proOut").textContent = `${fmt(proLo)} â€“ ${fmt(proHi)} g`;

      const calNotes = {
        cut: "Ø®ØµÙ… ~20% Ù…Ù† TDEE (Ù…Ø¹ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ ØªÙ‚Ø±ÙŠØ¨ÙŠ).",
        bulk: "Ø²ÙŠØ§Ø¯Ø© ~10% Ù…Ù† TDEE (Lean Bulk).",
        recomp: "Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ù‡Ø¯Ù: Ø¹Ø¶Ù„ + Ø¯Ù‡ÙˆÙ† Ø£Ù‚Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹).",
        maintain: "ØªØ«Ø¨ÙŠØª: Ù†ÙØ³ TDEE ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹."
      };
      $("calNote").textContent = calNotes[p.goal] || "â€”";
      $("proNote").textContent = "Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø­Ø³Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¬Ø³Ù… (Ø¬Ù…/ÙƒØ¬Ù…) ÙˆÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù‡Ø¯Ù.";
      generateMealPlan(cals, proLo, proHi, p.goal);
      updateAdvice();
    }

    function setExerciseOptions(){
      const split = $("daySelect").value;
      const list = EXERCISES.filter(e => e.split === split);
      $("exerciseSelect").innerHTML = list.map(e => `<option value="${e.id}">${e.name}</option>`).join("");
    }

    function updateLogInputsForGroup(){
      const g = $("daySelect").value;
      const repsLabel = $("repsLabel");
      const loadLabel = $("loadLabel");
      if(g === "cardio"){
        if(repsLabel) repsLabel.textContent = "Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)";
        if(loadLabel) loadLabel.textContent = "Ø§Ù„Ø´Ø¯Ø© (RPE) Ø£Ùˆ Ø§Ù„Ø³Ø±Ø¹Ø©";
        $("repsInput").placeholder = "Ù…Ø«Ø§Ù„: 20 Ø£Ùˆ 30";
        $("loadInput").placeholder = "Ù…Ø«Ø§Ù„: 7 Ø£Ùˆ 8.5";
      }else{
        if(repsLabel) repsLabel.textContent = "Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª (Reps)";
        if(loadLabel) loadLabel.textContent = "Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)";
        $("repsInput").placeholder = "Ù…Ø«Ø§Ù„: 12,10,8 Ø£Ùˆ 12 10 8";
        $("loadInput").placeholder = "Ù…Ø«Ø§Ù„: 40,45,50 Ø£Ùˆ 40 45 50";
      }
    }

    
    function parseNumberList(raw){
      // Supports: 12,10,8  |  12ØŒ10ØŒ8  |  12 10 8  |  12/10/8
      const cleaned = String(raw || "")
        .replaceAll("ØŒ", ",")
        .replaceAll(";", ",")
        .replaceAll("|", ",")
        .replaceAll("/", ",")
        .trim();

      // If user typed something like "12 10 8" convert spaces to commas
      const normalized = cleaned.replace(/\s+/g, ",");
      const parts = normalized.split(",").map(s => s.trim()).filter(Boolean);

      const nums = parts.map(p => Number(p)).filter(n => Number.isFinite(n));
      return nums;
    }


    let editingLogId = null;
    let plannerLastPlan = null;

    function setLogFormMode(isEdit){
      const addBtn = $("addSetBtn");
      const cancelBtn = $("btnCancelEdit");
      if(addBtn) addBtn.textContent = isEdit ? "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" : "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„";
      if(cancelBtn) cancelBtn.hidden = !isEdit;
    }

    function cancelLogEdit(){
      editingLogId = null;
      setLogFormMode(false);
      $("dateInput").value = todayISO();
      $("daySelect").value = "chest";
      setExerciseOptions();
      updateLogInputsForGroup();
      $("repsInput").value = "";
      $("loadInput").value = "";
      $("noteInput").value = "";
    }

    function startEditLogRow(id){
      const rows = loadLog();
      const row = rows.find(r => r.id === id);
      if(!row) return;

      editingLogId = id;
      $("dateInput").value = row.date || todayISO();
      $("daySelect").value = row.split || "chest";
      setExerciseOptions();
      if(row.exId) $("exerciseSelect").value = row.exId;
      updateLogInputsForGroup();
      $("repsInput").value = (row.reps ?? "").toString();
      $("loadInput").value = (row.load ?? "").toString();
      $("noteInput").value = (row.note ?? "").toString();
      setLogFormMode(true);

      // ensure training section is visible
      if(typeof openSection === "function"){ try{ openSection("workouts"); }catch(_e){} }
      const topEl = $("exerciseSelect");
      if(topEl) topEl.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function datePlusISO(offsetDays){
      const d = new Date();
      d.setHours(12,0,0,0);
      d.setDate(d.getDate() + Number(offsetDays || 0));
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function buildPlannerDayData(dayTitle, selectedSplits, opts, seed){
      const preset = plannerPresets(opts.level, opts.goalStyle);
      const sections = [];
      let totalExercises = 0;

      selectedSplits.forEach((split, idx) => {
        const isCardio = split === "cardio";
        const exCount = isCardio ? 1 : (selectedSplits.length > 2 ? 2 : 3);
        const chosen = groupExercisesForPlan(split, exCount, seed + idx);
        if(chosen.length === 0) return;
        totalExercises += chosen.length;

        const items = chosen.map((ex) => {
          if(isCardio){
            return {
              split, exId: ex.id, name: ex.name, isCardio: true,
              setsLabel: preset.cardio,
              repsTemplate: "20",
              loadTemplate: "0",
              noteHint: "ÙƒØ§Ø±Ø¯ÙŠÙˆ â€” Ø§Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¯Ø©/Ø§Ù„Ø´Ø¯Ø© Ø­Ø³Ø¨ Ù…Ø³ØªÙˆØ§Ùƒ"
            };
          }
          const isIsolation = /(Ø¹Ø²Ù„|Ø±ÙØ±ÙØ©|ÙƒÙŠØ±Ù„|Pushdown|Extension|Curl|Raise)/i.test(ex.name + " " + ex.target);
          const setsReps = isIsolation ? preset.isoSets : preset.mainSets;
          const repsTemplate = isIsolation ? "12,12,12" : "10,10,10";
          return {
            split, exId: ex.id, name: ex.name, isCardio: false,
            setsLabel: setsReps,
            repsTemplate,
            loadTemplate: "0,0,0",
            noteHint: `Ù…Ù‚ØªØ±Ø­ ${setsReps} â€” Ø¹Ø¯Ù‘Ù„ Ø§Ù„ÙˆØ²Ù† Ù„Ø§Ø­Ù‚Ù‹Ø§`
          };
        });

        sections.push({ split, isCardio, items });
      });

      return { title: dayTitle, totalExercises, sections, rest: preset.rest, note: preset.note };
    }

    function generatePlannerData(opts){
      const selected = opts.selectedSplits || [];
      if(!selected.length) return { period: opts.period, days: [] };

      const out = { period: opts.period, days: [] };

      if(opts.period === "daily"){
        const d = buildPlannerDayData("Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…", selected, opts, 0);
        out.days.push({ label: "Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…", dayOffset: 0, ...d });
        return out;
      }

      const buckets = distributeSplitsAcrossDays(selected, opts.daysPerWeek);
      if(opts.period === "weekly"){
        buckets.forEach((daySplits, i) => {
          const d = buildPlannerDayData(`Ø§Ù„ÙŠÙˆÙ… ${i+1}`, daySplits, opts, i*2);
          out.days.push({ label: `Ø§Ù„ÙŠÙˆÙ… ${i+1}`, dayOffset: i, ...d });
        });
        return out;
      }

      // monthly (4 weeks)
      for(let w=0; w<4; w++){
        buckets.forEach((daySplits, i) => {
          const d = buildPlannerDayData(`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w+1} - Ø§Ù„ÙŠÙˆÙ… ${i+1}`, daySplits, opts, w + i*2);
          out.days.push({ label: `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w+1} - Ø§Ù„ÙŠÙˆÙ… ${i+1}`, dayOffset: (w*7) + i, ...d });
        });
      }
      return out;
    }

    function addPlannerToLog(){
      if(!plannerLastPlan || !Array.isArray(plannerLastPlan.days) || plannerLastPlan.days.length === 0){
        alert("Ø£Ù†Ø´Ø¦ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ© Ù„ØªÙ…Ø§Ø±ÙŠÙ†ÙŠ.");
        return;
      }

      const rows = loadLog();
      let added = 0;
      const now = Date.now();

      plannerLastPlan.days.forEach((day, di) => {
        const date = datePlusISO(day.dayOffset ?? di);
        (day.sections || []).forEach(sec => {
          (sec.items || []).forEach((item, idx) => {
            rows.push({
              id: (crypto.randomUUID ? crypto.randomUUID() : String(now + added) + Math.random()),
              date,
              split: item.split,
              exId: item.exId,
              reps: item.repsTemplate || "",
              load: item.loadTemplate || "",
              note: `${item.noteHint || "Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­"} â€¢ ${day.label || day.title || ""}`.trim(),
              setsCount: (item.repsTemplate && String(item.repsTemplate).split(",").length) || 1,
              createdAt: now + added + idx
            });
            added++;
          });
        });
      });

      saveLog(rows);
      renderLog();
      setTab("log");
      if(typeof openSection === "function"){ try{ openSection("workouts"); }catch(_e){} }
      alert(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${added} ØªÙ…Ø±ÙŠÙ† Ø¥Ù„Ù‰ Ø³Ø¬Ù„Ùƒ âœ…\nÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ Ø³Ø·Ø± Ù…Ù† Ø²Ø± "ØªØ¹Ø¯ÙŠÙ„".`);
    }

    function addLogRow(){
      const date = $("dateInput").value || todayISO();
      const split = $("daySelect").value;
      const exId = $("exerciseSelect").value;
      const repsRaw = $("repsInput").value;
      const loadRaw = $("loadInput").value;
      const note = $("noteInput").value.trim();

      const ex = EXERCISES.find(e => e.id === exId);
      if(!ex) return;

      const repsArr = parseNumberList(repsRaw);
      const loadArr = parseNumberList(loadRaw);

      if(repsArr.length === 0 || loadArr.length === 0){
        alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª ÙˆØ§Ù„Ø£ÙˆØ²Ø§Ù†. Ù…Ø«Ø§Ù„: Reps = 12,10,8 Ùˆ Kg = 40,45,50");
        return;
      }

      let reps = repsArr.slice();
      let loads = loadArr.slice();

      // Allow single value repeat
      if(reps.length === 1 && loads.length > 1){
        reps = Array(loads.length).fill(reps[0]);
      } else if(loads.length === 1 && reps.length > 1){
        loads = Array(reps.length).fill(loads[0]);
      }

      if(reps.length !== loads.length){
        alert("Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ³Ø§ÙˆÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ²Ø§Ù† (Ø£Ùˆ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ÙˆØ³ÙŠØªÙ… ØªÙƒØ±Ø§Ø±Ù‡).");
        return;
      }

      for(let i=0;i<reps.length;i++){
        const r = reps[i];
        const w = loads[i];
        if(!Number.isFinite(r) || r <= 0){
          alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª: Ø£Ø±Ù‚Ø§Ù… Ù…ÙˆØ¬Ø¨Ø© ÙÙ‚Ø·.");
          return;
        }
        if(!Number.isFinite(w) || w < 0){
          alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø£ÙˆØ²Ø§Ù†: Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© (ÙŠÙ…ÙƒÙ† 0).");
          return;
        }
      }

      // Store all sets in ONE row (clearer for the user)
      const repsText = reps.join(",");
      const loadsText = loads.join(",");

      const rows = loadLog();
      const now = Date.now();

      if(editingLogId){
        const ix = rows.findIndex(r => r.id === editingLogId);
        if(ix !== -1){
          rows[ix] = {
            ...rows[ix],
            date,
            split,
            exId,
            reps: repsText,
            load: loadsText,
            note,
            setsCount: reps.length,
            updatedAt: now
          };
        }
      }else{
        rows.push({
          id: (crypto.randomUUID ? crypto.randomUUID() : String(now) + Math.random()),
          date,
          split,
          exId,
          reps: repsText,
          load: loadsText,
          note,
          setsCount: reps.length,
          createdAt: now
        });
      }

      saveLog(rows);

      $("repsInput").value = "";
      $("loadInput").value = "";
      $("noteInput").value = "";
      editingLogId = null;
      setLogFormMode(false);
      renderLog();
    }


    function deleteLogRow(id){
      const rows = loadLog().filter(r => r.id !== id);
      saveLog(rows);
      if(editingLogId === id){
        cancelLogEdit();
      }
      renderLog();
    }

    function renderLog(){
      const tbody = $("logTable").querySelector("tbody");
      const rows = loadLog().slice().sort((a,b) => (b.date.localeCompare(a.date)) || (b.createdAt - a.createdAt));

      tbody.innerHTML = rows.map(r => {
        const ex = EXERCISES.find(e=>e.id===r.exId) || {name:"â€”", target:"â€”"};
        const splitLabel = SPLIT_LABEL[r.split] || r.split;
        const repsCell = (r.reps === undefined || r.reps === null || r.reps === "") ? "â€”" : r.reps;
        const loadCell = (r.load === undefined || r.load === null || r.load === "") ? "â€”" : r.load;
        return `
          <tr>
            <td>${r.date}</td>
            <td>${splitLabel}</td>
            <td>${ex.name}</td>
            <td class="muted">${ex.target}</td>
            <td>${repsCell}</td>
            <td>${loadCell}</td>
            <td class="muted">${r.note ? r.note : "â€”"}</td>
            <td class="actionsCol">
              <div class="rowActions">
                <button class="secondary" onclick="window.__editRow('${r.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="secondary danger" onclick="window.__delRow('${r.id}')">Ø­Ø°Ù</button>
              </div>
            </td>
          </tr>
        `;
      }).join("");

      $("logCount").textContent = `${rows.length} Ø³Ø·Ø±`;
    }

    function exportCSV(){
      const rows = loadLog().slice().sort((a,b) => (a.date.localeCompare(b.date)) || (a.createdAt - b.createdAt));
      const header = ["date","split","exercise","target","reps","kg","note"].join(",");
      const lines = rows.map(r => {
        const ex = EXERCISES.find(e=>e.id===r.exId) || {name:"", target:""};
        const splitLabel = SPLIT_LABEL[r.split] || r.split;
        const esc = (s) => {
          const x = String(s ?? "");
          return /[",\n]/.test(x) ? `"${x.replaceAll('"','""')}"` : x;
        };
        return [esc(r.date), esc(splitLabel), esc(ex.name), esc(ex.target), esc(r.reps), esc(r.load), esc(r.note)].join(",");
      });
      const csv = [header, ...lines].join("\n");
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "workout_log.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function renderLibrary(){
      const q = $("libSearch").value.trim().toLowerCase();
      const f = $("libSplitFilter").value;
      const tbody = $("libTable").querySelector("tbody");

      const rows = EXERCISES.filter(e => {
        const okSplit = (f === "all") ? true : (e.split === f);
        const okQ = !q ? true : (e.name.toLowerCase().includes(q) || e.target.toLowerCase().includes(q));
        return okSplit && okQ;
      });

      tbody.innerHTML = rows.map(e => `
        <tr>
          <td>${e.name}</td>
          <td class="muted">${e.target}</td>
          <td>${SPLIT_LABEL[e.split] || e.split}</td>
          <td class="muted">${e.cue}</td>
          <td><a class="link" href="${e.yt}" target="_blank" rel="noopener">ÙØªØ­</a></td>
        </tr>
      `).join("");
    }

    function getPlannerSelections(){
      return Array.from(document.querySelectorAll('.plannerMuscle:checked')).map(el => el.value);
    }

    function updatePlannerSelectionState(fromAllToggle=false){
      const allBox = $("plannerAllMuscles");
      const checks = Array.from(document.querySelectorAll(".plannerMuscle"));
      if(!checks.length || !allBox) return;

      if(fromAllToggle){
        checks.forEach(ch => { ch.checked = allBox.checked; });
      }

      const selected = checks.filter(ch => ch.checked).length;
      allBox.checked = selected === checks.length;
      allBox.indeterminate = selected > 0 && selected < checks.length;

      const badge = $("plannerSelectedCount");
      if(badge) badge.textContent = `${selected} Ø¹Ø¶Ù„Ø©`;
    }

    function groupExercisesForPlan(split, count, seed=0){
      const list = EXERCISES.filter(e => e.split === split);
      if(list.length === 0) return [];
      const out = [];
      const safeCount = Math.max(1, Math.min(count, list.length));
      for(let i=0;i<safeCount;i++){
        out.push(list[(seed + i) % list.length]);
      }
      return out;
    }

    function plannerPresets(level, goalStyle){
      const levelMap = {
        beginner: { mainSets: "3Ã—8â€“12", isoSets: "2â€“3Ã—10â€“15", cardio: "20â€“30 Ø¯Ù‚ÙŠÙ‚Ø©", rest: "60â€“90Ø«" },
        intermediate: { mainSets: "3â€“4Ã—6â€“12", isoSets: "3â€“4Ã—10â€“15", cardio: "25â€“35 Ø¯Ù‚ÙŠÙ‚Ø©", rest: "60â€“120Ø«" },
        advanced: { mainSets: "4â€“5Ã—5â€“10", isoSets: "3â€“5Ã—8â€“15", cardio: "30â€“40 Ø¯Ù‚ÙŠÙ‚Ø©", rest: "60â€“150Ø«" }
      };
      const p = levelMap[level] || levelMap.beginner;
      if(goalStyle === "fatloss"){
        return { ...p, cardio: level === "advanced" ? "30â€“45 Ø¯Ù‚ÙŠÙ‚Ø©" : "25â€“40 Ø¯Ù‚ÙŠÙ‚Ø©", note: "Ø£Ø¶Ù ÙƒØ§Ø±Ø¯ÙŠÙˆ 2â€“4 Ù…Ø±Ø§Øª Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø¹ Ø¹Ø¬Ø² Ø³Ø¹Ø±Ø§Øª Ø¨Ø³ÙŠØ·." };
      }
      if(goalStyle === "general"){
        return { ...p, note: "Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©." };
      }
      return { ...p, note: "Ø²ÙØ¯ Ø§Ù„ÙˆØ²Ù† Ø£Ùˆ Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ø­Ø§ÙØ¸Øª Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ù†ÙŠØ©." };
    }

    function buildPlanDayHTML(dayTitle, selectedSplits, opts, seed){
      const preset = plannerPresets(opts.level, opts.goalStyle);
      const parts = [];
      let totalExercises = 0;

      selectedSplits.forEach((split, idx) => {
        const isCardio = split === "cardio";
        const exCount = isCardio ? 1 : (selectedSplits.length > 2 ? 2 : 3);
        const chosen = groupExercisesForPlan(split, exCount, seed + idx);
        if(chosen.length === 0) return;
        totalExercises += chosen.length;

        const items = chosen.map((ex) => {
          if(isCardio){
            return `<li><b>${ex.name}</b> â€” ${preset.cardio} â€¢ Ø´Ø¯Ø© Ù…ØªÙˆØ³Ø·Ø© (RPE 6â€“8)</li>`;
          }
          const isIsolation = /(Ø¹Ø²Ù„|Ø±ÙØ±ÙØ©|ÙƒÙŠØ±Ù„|Pushdown|Extension|Curl|Raise)/i.test(ex.name + " " + ex.target);
          const setsReps = isIsolation ? preset.isoSets : preset.mainSets;
          return `<li><b>${ex.name}</b> â€” ${setsReps}</li>`;
        }).join("");

        parts.push(`
          <div style="margin-top:6px;">
            <div class="planMeta"><b>${SPLIT_LABEL[split] || split}</b> â€¢ ${isCardio ? "ÙƒØ§Ø±Ø¯ÙŠÙˆ" : "Ù…Ù‚Ø§ÙˆÙ…Ø©"}</div>
            <ul>${items}</ul>
          </div>
        `);
      });

      const warmup = selectedSplits.includes("cardio") && selectedSplits.length === 1
        ? "Ø¥Ø­Ù…Ø§Ø¡ 3â€“5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø«Ù… Ø§Ø¨Ø¯Ø£ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§."
        : "Ø¥Ø­Ù…Ø§Ø¡ 5â€“8 Ø¯Ù‚Ø§Ø¦Ù‚ + Ù…Ø¬Ù…ÙˆØ¹Ø© ØªÙ…Ù‡ÙŠØ¯ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.";

      return `
        <div class="planDay">
          <h4>${dayTitle}</h4>
          <div class="planMeta">ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ ${totalExercises} ØªÙ…Ø§Ø±ÙŠÙ† â€¢ Ø±Ø§Ø­Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª: ${preset.rest}</div>
          <div class="planMeta">${warmup}</div>
          ${parts.join("")}
          <div class="planMeta" style="margin-top:8px;">${preset.note}</div>
        </div>
      `;
    }

    function distributeSplitsAcrossDays(selected, daysPerWeek){
      const days = Math.max(1, Number(daysPerWeek) || 4);
      const buckets = Array.from({length: days}, () => []);
      if(selected.length === 0) return buckets;

      // Spread groups evenly
      selected.forEach((split, i) => {
        buckets[i % days].push(split);
      });

      // If some days are empty, fill with cardio or repeat priority groups
      const priority = ["chest","back","legs","shoulders","triceps","biceps","core","cardio"];
      const selectedPriority = priority.filter(p => selected.includes(p));
      buckets.forEach((b, i) => {
        if(b.length === 0){
          b.push(selectedPriority[i % selectedPriority.length] || "cardio");
        }
      });

      // Avoid tiny "cardio-only" day if cardio selected with many groups; merge cardio to nearest day
      if(selected.length >= 4 && selected.includes("cardio")){
        for(let i=0;i<buckets.length;i++){
          if(buckets[i].length === 1 && buckets[i][0] === "cardio"){
            const target = i === 0 ? 1 : i-1;
            if(buckets[target]){
              if(!buckets[target].includes("cardio")) buckets[target].push("cardio");
              buckets[i] = [];
            }
          }
        }
      }

      return buckets.filter(b => b.length > 0);
    }

    function generatePlannerHTML(opts){
      const selected = opts.selectedSplits || [];
      if(!selected.length){
        return '<div class="hint">Ø§Ø®ØªØ± Ø¹Ø¶Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</div>';
      }

      const planType = opts.period;
      let htmlOut = '';

      if(planType === 'daily'){
        htmlOut += `<div class="planMeta" style="margin-bottom:8px;">Ø®Ø·Ø© ÙŠÙˆÙ…ÙŠØ© Ù…Ø®ØµØµØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ (${selected.map(s => SPLIT_LABEL[s]).join(" + ")}).</div>`;
        htmlOut += buildPlanDayHTML("Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…", selected, opts, 0);
        htmlOut += `<div class="hint" style="margin-top:10px;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø£Ùˆ Ø§Ù„Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ†ÙˆÙŠØ¹ Ù…Ø®ØªÙ„Ù ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†.</div>`;
        return htmlOut;
      }

      const buckets = distributeSplitsAcrossDays(selected, opts.daysPerWeek);
      if(planType === 'weekly'){
        htmlOut += `<div class="planMeta" style="margin-bottom:8px;">Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© â€¢ ${buckets.length} Ø£ÙŠØ§Ù… ØªÙ…Ø±ÙŠÙ†</div>`;
        buckets.forEach((daySplits, i) => {
          htmlOut += buildPlanDayHTML(`Ø§Ù„ÙŠÙˆÙ… ${i+1}`, daySplits, opts, i*2);
        });
        if(buckets.length < 7){
          htmlOut += `<div class="hint" style="margin-top:10px;">Ø§Ù„Ø£ÙŠØ§Ù… ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø© ØªØ¹ØªØ¨Ø± Ø±Ø§Ø­Ø©/Ù…Ø´ÙŠ Ø®ÙÙŠÙ/Ø¥Ø·Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ø§ÙÙŠ.</div>`;
        }
        return htmlOut;
      }

      // Monthly = 4-week progression template
      htmlOut += `<div class="planMeta" style="margin-bottom:8px;">Ø®Ø·Ø© Ø´Ù‡Ø±ÙŠØ© (4 Ø£Ø³Ø§Ø¨ÙŠØ¹) â€¢ Ù†ÙØ³ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø¹ ØªØ¯Ø±Ø¬ ØªØ¯Ø±ÙŠØ¬ÙŠ</div>`;
      const weekNotes = [
        "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1: Ø§Ø¨Ø¯Ø£ Ø¨ÙˆØ²Ù† Ù…Ø±ÙŠØ­ ÙˆØ§ØªØ±Ùƒ 2 Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø®Ø²Ø§Ù† (RIR 2).",
        "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2: Ø²ÙØ¯ Ø¹Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ ÙˆØ²Ù† Ø¨Ø³ÙŠØ· (2.5â€“5%).",
        "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3: Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø£Ùˆ Ø£Ø¶Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¹Ø¶Ù„Ø© ØªØ­ØªØ§Ø¬ ØªØ±ÙƒÙŠØ².",
        "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4: Ø®ÙÙ Ø§Ù„Ø­Ø¬Ù… 20â€“30% (Deload Ø®ÙÙŠÙ) Ø¥Ø°Ø§ Ø´Ø¹Ø±Øª Ø¨Ø¥Ø¬Ù‡Ø§Ø¯."
      ];
      for(let w=0; w<4; w++){
        htmlOut += `<div class="planDay"><h4>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w+1}</h4><div class="planMeta">${weekNotes[w]}</div>`;
        buckets.forEach((daySplits, i) => {
          htmlOut += `<div style="margin-top:8px;">${buildPlanDayHTML(`Ø§Ù„ÙŠÙˆÙ… ${i+1}`, daySplits, opts, w + i*2)}</div>`;
        });
        htmlOut += `</div>`;
      }
      return htmlOut;
    }

    function copyPlannerOutput(){
      const out = $("plannerOutput");
      if(!out) return;
      const text = out.innerText.trim();
      if(!text) return;
      navigator.clipboard?.writeText(text)
        .then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ…"))
        .catch(() => alert("ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø§Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§."));
    }


    function setTab(tab){
      const tabs = ["log","plan","library","tips"];
      tabs.forEach(t => $("tab-"+t).style.display = (t===tab) ? "block" : "none");
      document.querySelectorAll(".tab").forEach(el => el.classList.toggle("active", el.dataset.tab === tab));
      if(tab === "library") renderLibrary();
      if(tab === "tips") updateAdvice();
    }

    async function init(){
      $("dateInput").value = todayISO();
      updatePlannerSelectionState(false);

      // Render local (guest) state first (app hidden until login)
      fillProfileForm(loadProfile());
      calcAndRender();
      setMainVisibility(false);
      setProfileEditor(true);

      await initFirebaseServices();

      if(!cloud.enabled || !cloud.auth){
        setPillMessage("authMsg", "ØªØ¹Ø°Ø± ØªÙ‡ÙŠØ¦Ø© Firebase/Auth. Ø±Ø§Ø¬Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø©.", true);
      }

      if(cloud.enabled && cloud.auth){
        onAuthStateChanged(cloud.auth, async (user) => {
          if(user){
            cloud.user = user;
            cloud.docRef = doc(cloud.db, "fitness_app_users", user.uid);

            refreshUserBadge();
            setMainVisibility(true);

            await loadFromCloudForUser(user);

            fillProfileForm(loadProfile());
            calcAndRender();
            setExerciseOptions();
            renderLog();
            renderLibrary();
            updateAdvice();

            const complete = isProfileComplete(loadProfile());
            setProfileEditor(!complete);
            updateSaveState();
          }else{
            cloud.user = null;
            cloud.docRef = null;
            cloud.status = "local";
            refreshUserBadge();
            setMainVisibility(false);
            setProfileEditor(true);
            updateSaveState();
          }
        });
      }else{
        // Fallback local-only
        setMainVisibility(true);
        $("userBar").hidden = true;
        setProfileEditor(true);
      }

      // Continue normal setup (tabs/etc.)

      setExerciseOptions();
      updateLogInputsForGroup();
      renderLog();
      renderLibrary();
      updateAdvice();

      $("calcBtn").addEventListener("click", calcAndRender);

      $("saveBtn").addEventListener("click", () => {
        const p = readProfileForm();
        saveProfile(p);
        calcAndRender();

        const complete = isProfileComplete(p);
        if(complete && cloud.user){
          setProfileEditor(false);
        }else{
          setProfileEditor(true);
        }

        updateSaveState(complete ? "ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…" : "ØªÙ… Ø§Ù„Ø­ÙØ¸ (Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)");
        setTimeout(()=> updateSaveState(), 1600);
      });

      $("resetBtn").addEventListener("click", () => {
        if(!confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ³Ø¬Ù„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
        clearCurrentLocalData();
        scheduleCloudSync();
        fillProfileForm({});
        calcAndRender();
        renderLog();
        renderLibrary();
        setProfileEditor(true);
        updateSaveState("ØªÙ… Ø§Ù„Ù…Ø³Ø­");
        setTimeout(()=> updateSaveState(), 1600);
      });

      ["sex","age","height","weight","activity","goal","cardioPref"].forEach(id => $(id).addEventListener("change", calcAndRender));

      $("daySelect").addEventListener("change", () => {
        setExerciseOptions();
        updateLogInputsForGroup();
        renderLibrary();
      });

      $("addSetBtn").addEventListener("click", addLogRow);
      $("btnCancelEdit")?.addEventListener("click", cancelLogEdit);
      $("exportBtn").addEventListener("click", exportCSV);
      $("clearLogBtn").addEventListener("click", () => {
        if(!confirm("Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
        saveLog([]);
        renderLog();
        updateSaveState("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„");
        setTimeout(()=> updateSaveState(), 1200);
      });

      // Planner modal (optional workout schedule generator)
      const openPlanner = () => {
        updatePlannerSelectionState(false);
        $("plannerModal").hidden = false;
      };
      const closePlanner = () => { $("plannerModal").hidden = true; };

      $("btnPlannerModal")?.addEventListener("click", openPlanner);
      $("btnClosePlanner")?.addEventListener("click", closePlanner);
      $("plannerModal")?.addEventListener("click", (e) => { if(e.target === $("plannerModal")) closePlanner(); });

      $("plannerAllMuscles")?.addEventListener("change", () => updatePlannerSelectionState(true));
      document.querySelectorAll(".plannerMuscle").forEach(el => {
        el.addEventListener("change", () => updatePlannerSelectionState(false));
      });

      $("btnGeneratePlanner")?.addEventListener("click", () => {
        const selectedSplits = getPlannerSelections();
        if(selectedSplits.length === 0){
          $("plannerOutput").innerHTML = '<div class="hint">Ø§Ø®ØªØ± Ø¹Ø¶Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</div>';
          updatePlannerSelectionState(false);
          return;
        }
        const plannerOpts = {
          selectedSplits,
          period: $("plannerPeriod").value,
          daysPerWeek: Number($("plannerDaysPerWeek").value || 4),
          goalStyle: $("plannerGoalStyle").value,
          level: $("plannerLevel").value
        };
        const htmlPlan = generatePlannerHTML(plannerOpts);
        plannerLastPlan = generatePlannerData(plannerOpts);
        $("plannerOutput").innerHTML = htmlPlan;
      });

      $("btnCopyPlanner")?.addEventListener("click", copyPlannerOutput);
      $("btnAddPlannerToLog")?.addEventListener("click", addPlannerToLog);

      document.querySelectorAll(".tab").forEach(el => el.addEventListener("click", ()=> setTab(el.dataset.tab)));

      $("libSearch").addEventListener("input", renderLibrary);
      $("libSplitFilter").addEventListener("change", renderLibrary);

      // Auth buttons
      $("btnRegister").addEventListener("click", async () => {
        if(!cloud.auth){
          setPillMessage("authMsg", "Ø®Ø¯Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", true);
          return;
        }
        try{
          const email = $("authEmail").value.trim();
          const pass = $("authPassword").value;
          if(!email || !pass){
            setPillMessage("authMsg", "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.", true);
            return;
          }
          setPillMessage("authMsg", "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨â€¦");
          await createUserWithEmailAndPassword(cloud.auth, email, pass);
          setPillMessage("authMsg", "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
        }catch(err){
          setPillMessage("authMsg", authErrorText(err), true);
        }
      });

      $("btnLogin").addEventListener("click", async () => {
        if(!cloud.auth){
          setPillMessage("authMsg", "Ø®Ø¯Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", true);
          return;
        }
        try{
          const email = $("authEmail").value.trim();
          const pass = $("authPassword").value;
          if(!email || !pass){
            setPillMessage("authMsg", "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.", true);
            return;
          }
          setPillMessage("authMsg", "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„â€¦");
          await signInWithEmailAndPassword(cloud.auth, email, pass);
          setPillMessage("authMsg", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
        }catch(err){
          setPillMessage("authMsg", authErrorText(err), true);
        }
      });

      $("btnForgot").addEventListener("click", async () => {
        if(!cloud.auth){
          setPillMessage("authMsg", "Ø®Ø¯Ù…Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.", true);
          return;
        }
        try{
          const email = $("authEmail").value.trim();
          if(!email){
            setPillMessage("authMsg", "Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.", true);
            return;
          }
          await sendPasswordResetEmail(cloud.auth, email);
          setPillMessage("authMsg", "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± âœ…");
        }catch(err){
          setPillMessage("authMsg", authErrorText(err), true);
        }
      });

      $("authPassword").addEventListener("keydown", (e) => {
        if(e.key === "Enter") $("btnLogin").click();
      });

      $("btnLogout").addEventListener("click", async () => {
        if(!cloud.auth){
          setPillMessage("authMsg", "Ø®Ø¯Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.", true);
          return;
        }
        try{ await signOut(cloud.auth); }catch(err){ alert(authErrorText(err)); }
      });

      $("btnEditProfile").addEventListener("click", () => {
        try{
          if(typeof window.__openHomeDetail === "function"){
            window.__openHomeDetail("daily");
          }
        }catch(_e){}
        setProfileEditor(true);
        setTimeout(() => {
          $("profileFormSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 60);
      });

      // Account modal
      const openAccount = () => {
        if(!cloud.user){
          setPillMessage("authMsg", "Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.", true);
          return;
        }
        $("accDisplayName").value = cloud.user.displayName || "";
        $("accPhotoUrl").value = cloud.user.photoURL || "";
        setPillMessage("accountMsg", "");
        $("accountModal").hidden = false;
      };
      const closeAccount = () => { $("accountModal").hidden = true; };

      $("btnAccount").addEventListener("click", openAccount);
      $("btnCloseAccount").addEventListener("click", closeAccount);
      $("accountModal").addEventListener("click", (e) => { if(e.target === $("accountModal")) closeAccount(); });

      $("btnSaveAccount").addEventListener("click", async () => {
        try{
          if(!cloud.user) return;
          const dn = $("accDisplayName").value.trim();
          const pu = $("accPhotoUrl").value.trim();
          await updateProfile(cloud.user, { displayName: dn || null, photoURL: pu || null });
          refreshUserBadge();
          setPillMessage("accountMsg", "ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
        }catch(err){
          setPillMessage("accountMsg", authErrorText(err), true);
        }
      });

      $("btnVerifyEmail").addEventListener("click", async () => {
        try{
          if(!cloud.user) return;
          await sendEmailVerification(cloud.user);
          setPillMessage("accountMsg", "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ âœ…");
        }catch(err){
          setPillMessage("accountMsg", authErrorText(err), true);
        }
      });

      $("btnResetPasswordEmail").addEventListener("click", async () => {
        try{
          if(!cloud.auth) return;
          const email = cloud.user?.email || $("authEmail").value.trim();
          if(!email){
            setPillMessage("accountMsg", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·.", true);
            return;
          }
          await sendPasswordResetEmail(cloud.auth, email);
          setPillMessage("accountMsg", "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† âœ…");
        }catch(err){
          setPillMessage("accountMsg", authErrorText(err), true);
        }
      });

      $("btnChangePassword").addEventListener("click", async () => {
        try{
          if(!cloud.user) return;
          const currentPass = $("accCurrentPass").value;
          const newPass = $("accNewPass").value;
          if(!currentPass || !newPass){
            setPillMessage("accountMsg", "Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø©.", true);
            return;
          }
          const cred = EmailAuthProvider.credential(cloud.user.email, currentPass);
          await reauthenticateWithCredential(cloud.user, cred);
          await updatePassword(cloud.user, newPass);
          $("accCurrentPass").value = "";
          $("accNewPass").value = "";
          setPillMessage("accountMsg", "ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± âœ…");
        }catch(err){
          setPillMessage("accountMsg", authErrorText(err), true);
        }
      });

      window.__delRow = deleteLogRow;
      window.__editRow = startEditLogRow;
    }

    // Expose selected app helpers for the non-module home enhancer script.
    window.__fitnessAppBridge = {
      FOOD_LIBRARY,
      FOOD_CATEGORY_LABEL,
      loadDietPrefs,
      saveDietPrefs,
      buildDietChoicePlanHTML
    };

    init();
  </script>

  <script id="cardsHomeEnhancer">
    (function(){
      function ready(fn){
        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn, {once:true});
        else fn();
      }
      ready(function(){
        const bridge = window.__fitnessAppBridge || {};
        const FOOD_LIBRARY = Array.isArray(bridge.FOOD_LIBRARY) ? bridge.FOOD_LIBRARY : [];
        const FOOD_CATEGORY_LABEL = bridge.FOOD_CATEGORY_LABEL || {};
        const loadDietPrefs = typeof bridge.loadDietPrefs === 'function' ? bridge.loadDietPrefs : (() => ({ selected: [], updatedAtClient: 0 }));
        const saveDietPrefs = typeof bridge.saveDietPrefs === 'function' ? bridge.saveDietPrefs : (() => {});
        const buildDietChoicePlanHTML = typeof bridge.buildDietChoicePlanHTML === 'function'
          ? bridge.buildDietChoicePlanHTML
          : (() => '<span class="muted">Ø§Ø­Ø³Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ.</span>');

        const appMain = document.getElementById('appMain');
        if(!appMain) return;

        const homeHub = document.getElementById('homeHub');
        const detailShell = document.getElementById('detailShell');
        const detailViews = document.getElementById('detailViews');
        const detailTitle = document.getElementById('detailTitle');
        const backBtn = document.getElementById('detailBackBtn');

        const cards = appMain.querySelectorAll(':scope > section.card');
        const dailyCard = cards[0] || null;
        const workoutCard = cards[1] || null;
        if(!dailyCard || !workoutCard) return;

        appMain.classList.add('cardsHomeEnabled');
        dailyCard.id = 'dailyDetailCard';
        workoutCard.id = 'workoutDetailCard';

        // Move existing sections into detail container
        detailViews.appendChild(dailyCard);
        detailViews.appendChild(workoutCard);

        // Build diet detail card (mirrors meal plan + summary)
        const dietCard = document.createElement('section');
        dietCard.className = 'card dietCard';
        dietCard.id = 'dietDetailCard';
        dietCard.hidden = true;
        dietCard.innerHTML = `
          <div class="hd">
            <h2>Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</h2>
            <span class="pill">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø©</span>
          </div>
          <div class="bd">
            <div class="hint" id="dietIntro">Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø© ØªÙØ¨Ù†Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ ÙƒØ°Ù„Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ ÙˆØ­ÙØ¸Ù‡Ø§.</div>

            <div class="foodPickerWrap">
              <div class="foodPickerHead">
                <div>
                  <div class="title">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ</div>
                  <div class="subtxt">Ø­Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨ÙƒØŒ ÙˆØ³ØªØ±Ù‰ Ù„ÙƒÙ„ ØµÙ†Ù Ø³Ø¹Ø±Ø§ØªÙ‡ ÙˆØ¨Ø±ÙˆØªÙŠÙ†Ù‡ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ØŒ Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­ ÙŠÙˆÙ…ÙŠ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>
                </div>
                <button class="secondary foodPickerToggle" id="btnToggleFoodPicker" type="button">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
              </div>
              <div class="foodSummary" id="foodPickSummary">Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø£Ø·Ø¹Ù…Ø© Ø¨Ø¹Ø¯.</div>
              <div class="foodPickerPanel" id="foodPickerPanel">
                <div class="foodSearch">
                  <label>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¹Ø§Ù…</label>
                  <input id="foodSearchInput" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªÙˆÙ†Ø© / Ø®Ø¨Ø² / Ø¨ÙŠØ¶ / Ù„Ø­Ù…..." />
                </div>
                <div class="foodGroups" id="foodGroups"></div>
                <div class="foodPickerActions">
                  <button id="btnSaveFoodPrefs" type="button">Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø·Ø¹Ù…Ø©</button>
                  <button class="secondary" id="btnClearFoodPrefs" type="button">ØªØµÙÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</button>
                </div>
              </div>
              <div class="dietChoicePlan" id="dietChoicePlanMirror">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨ÙƒØŒ Ø«Ù… Ø§Ø¶ØºØ· "Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø·Ø¹Ù…Ø©".</div>
            </div>

            <div class="dietTop">
              <div class="dietMini">
                <div class="t">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</div>
                <div class="v" id="dietCalMirror">â€”</div>
                <div class="s" id="dietCalNoteMirror">â€”</div>
              </div>
              <div class="dietMini">
                <div class="t">Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù…Ù‚ØªØ±Ø­</div>
                <div class="v" id="dietProMirror">â€”</div>
                <div class="s" id="dietProNoteMirror">â€”</div>
              </div>
            </div>
            <div class="dietPlanBox" id="dietPlanMirror">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø¶ØºØ· "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†" Ø«Ù… Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø®Ø·Ø© Ù‡Ù†Ø§.</div>
          </div>`;
        detailViews.appendChild(dietCard);

        const dailyBody = dailyCard.querySelector('.bd');
        const dailyFooter = dailyCard.querySelector('.footer');

        function setMainMode(){
          // Hide default detail cards until user opens one
          if(appMain.hidden) return;
          if(!detailShell.hidden || !homeHub.hidden) return;
          showHome();
        }

        function showHome(){
          homeHub.hidden = false;
          detailShell.hidden = true;
          dailyCard.hidden = true;
          workoutCard.hidden = true;
          dietCard.hidden = true;
          // Restore full daily card for next open
          if(dailyBody) dailyBody.hidden = false;
          if(dailyFooter) dailyFooter.hidden = false;
        }

        function openDetail(kind){
          homeHub.hidden = true;
          detailShell.hidden = false;
          dailyCard.hidden = true;
          workoutCard.hidden = true;
          dietCard.hidden = true;

          if(kind === 'daily'){
            detailTitle.textContent = 'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ + Ø§Ù„Ø­Ø³Ø¨Ø©';
            dailyCard.hidden = false;
            if(dailyBody) dailyBody.hidden = false;
            if(dailyFooter) dailyFooter.hidden = true; // keep focus on calculations
          } else if(kind === 'diet'){
            detailTitle.textContent = 'Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©';
            dietCard.hidden = false;
            initFoodPickerUI();
          } else {
            detailTitle.textContent = 'Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†';
            workoutCard.hidden = false;
          }
          window.scrollTo({top:0, behavior:'smooth'});
        }

        window.__openHomeDetail = openDetail;
        window.__showHomeHub = showHome;

        backBtn.addEventListener('click', showHome);
        homeHub.querySelectorAll('.homeCard').forEach(c => c.addEventListener('click', () => openDetail(c.dataset.open)));

        // Greeting in header (insert once under subtitle)
        const headerSub = document.querySelector('header .sub');
        if(headerSub && !document.getElementById('headerGreetingLine')){
          const g = document.createElement('div');
          g.id = 'headerGreetingLine';
          g.className = 'pill';
          g.style.marginTop = '8px';
          g.style.width = 'fit-content';
          g.textContent = 'Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹';
          headerSub.insertAdjacentElement('afterend', g);
        }

        function normalizeName(v){
          if(!v) return 'ØµØ¯ÙŠÙ‚Ù†Ø§';
          const s = String(v).trim();
          if(!s) return 'ØµØ¯ÙŠÙ‚Ù†Ø§';
          // Keep the full entered name (e.g., "Ø£Ø¨Ùˆ Ø¬Ù…Ø§Ù„") for the main greeting.
          if(s.includes('@')) return s.split('@')[0];
          return s;
        }


        let foodDraftSelection = [];
        let foodPickerExpanded = true;

        function getSavedFoodSelection(){
          const raw = loadDietPrefs();
          const selected = Array.isArray(raw?.selected) ? raw.selected.filter(id => FOOD_LIBRARY.some(item => item.id === id)) : [];
          return [...new Set(selected)];
        }

        function setFoodPickerExpanded(expanded){
          foodPickerExpanded = !!expanded;
          const panel = document.getElementById('foodPickerPanel');
          const btn = document.getElementById('btnToggleFoodPicker');
          if(panel) panel.hidden = !foodPickerExpanded;
          if(btn) btn.textContent = foodPickerExpanded ? 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©' : 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©';
        }

        function renderFoodPicker(filterText=''){
          const wrap = document.getElementById('foodGroups');
          if(!wrap) return;

          const q = String(filterText || '').trim().toLowerCase();
          const filtered = FOOD_LIBRARY.filter(item => {
            if(!q) return true;
            const hay = `${item.name} ${item.serving || ''} ${FOOD_CATEGORY_LABEL[item.cat] || ''}`.toLowerCase();
            return hay.includes(q);
          });

          if(!filtered.length){
            wrap.innerHTML = '<div class="foodGroup" style="grid-column:1 / -1;"><div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø¬Ø±Ù‘Ø¨ ÙƒÙ„Ù…Ø© Ø£Ø¨Ø³Ø·.</div></div>';
            return;
          }

          const grouped = {};
          filtered.forEach(item => {
            if(!grouped[item.cat]) grouped[item.cat] = [];
            grouped[item.cat].push(item);
          });

          const fmtProtein = (n) => Number.isInteger(n) ? `${n}` : `${n}`;
          const order = ['protein','carbs','dairy','fruits','veggies','fats'];
          wrap.innerHTML = order.filter(cat => grouped[cat]?.length).map(cat => `
            <section class="foodGroup">
              <h4>${FOOD_CATEGORY_LABEL[cat] || cat}</h4>
              <div class="foodChips">
                ${grouped[cat].map(item => `
                  <button type="button" class="foodChip ${foodDraftSelection.includes(item.id) ? 'active' : ''}" data-food-id="${item.id}">
                    <span class="foodChipName">${item.name}</span>
                    <span class="foodChipMeta">${item.serving || 'Ø­ØµØ©'} â€¢ ${item.kcal || 0} Ø³Ø¹Ø±Ø© â€¢ ${fmtProtein(item.protein || 0)} Ø¬Ù… Ø¨Ø±ÙˆØªÙŠÙ†</span>
                  </button>
                `).join('')}
              </div>
            </section>
          `).join('');
        }

        function refreshFoodSummary(){
          const summary = document.getElementById('foodPickSummary');
          const plan = document.getElementById('dietChoicePlanMirror');
          if(!summary || !plan) return;

          const saved = getSavedFoodSelection();
          const draftChanged = JSON.stringify([...foodDraftSelection].sort()) !== JSON.stringify([...saved].sort());
          const selectedItems = foodDraftSelection.map(id => FOOD_LIBRARY.find(item => item.id === id)).filter(Boolean);
          const totalKcal = selectedItems.reduce((sum, item) => sum + (Number(item.kcal) || 0), 0);
          const totalProtein = Math.round(selectedItems.reduce((sum, item) => sum + (Number(item.protein) || 0), 0) * 10) / 10;

          if(!selectedItems.length){
            summary.innerHTML = '<strong>Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªÙŠØ§Ø±Ùƒ:</strong> Ø§Ø®ØªØ± Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ùƒ Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸ØŒ ÙˆØ³ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø§Ù‹ Ù„Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹.';
          }else{
            const preview = selectedItems.slice(0, 5).map(item => item.name).join(' â€¢ ');
            summary.innerHTML = `<strong>${selectedItems.length} ØµÙ†ÙÙ‹Ø§ Ù…Ø®ØªØ§Ø±Ù‹Ø§</strong>${draftChanged ? ' (Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯)' : ' ÙˆÙ…Ø­ÙÙˆØ¸Ø© Ù„Ùƒ'}<br><span class="muted">Ù…Ø¬Ù…ÙˆØ¹ ØªÙ‚Ø±ÙŠØ¨ÙŠ: ${totalKcal} Ø³Ø¹Ø±Ø© â€¢ ${totalProtein} Ø¬Ù… Ø¨Ø±ÙˆØªÙŠÙ†</span><br><span class="muted">${preview}${selectedItems.length > 5 ? ' â€¦' : ''}</span>`;
          }

          const previewIds = draftChanged ? foodDraftSelection : (saved.length ? saved : foodDraftSelection);
          plan.innerHTML = buildDietChoicePlanHTML(previewIds);
        }

        function saveFoodSelections(){
          const unique = [...new Set(foodDraftSelection)].slice(0, 36);
          saveDietPrefs({
            selected: unique,
            updatedAtClient: Date.now()
          });
          foodDraftSelection = unique.slice();
          refreshFoodSummary();
          setTimeout(() => { mirrorDietData(); }, 20);
        }

        function clearFoodSelections(){
          foodDraftSelection = [];
          saveDietPrefs({
            selected: [],
            updatedAtClient: Date.now()
          });
          renderFoodPicker(document.getElementById('foodSearchInput')?.value || '');
          refreshFoodSummary();
          setTimeout(() => { mirrorDietData(); }, 20);
        }

        function bindFoodPickerEvents(){
          const wrap = document.getElementById('foodGroups');
          const search = document.getElementById('foodSearchInput');
          const saveBtn = document.getElementById('btnSaveFoodPrefs');
          const clearBtn = document.getElementById('btnClearFoodPrefs');
          const toggleBtn = document.getElementById('btnToggleFoodPicker');

          if(wrap && !wrap.dataset.bound){
            wrap.dataset.bound = '1';
            wrap.addEventListener('click', (e) => {
              const btn = e.target.closest('.foodChip');
              if(!btn) return;
              const id = btn.dataset.foodId;
              if(!id) return;
              if(foodDraftSelection.includes(id)) foodDraftSelection = foodDraftSelection.filter(x => x !== id);
              else foodDraftSelection.push(id);
              renderFoodPicker(search?.value || '');
              refreshFoodSummary();
            });
          }

          if(search && !search.dataset.bound){
            search.dataset.bound = '1';
            search.addEventListener('input', () => renderFoodPicker(search.value));
          }

          if(saveBtn && !saveBtn.dataset.bound){
            saveBtn.dataset.bound = '1';
            saveBtn.addEventListener('click', saveFoodSelections);
          }

          if(clearBtn && !clearBtn.dataset.bound){
            clearBtn.dataset.bound = '1';
            clearBtn.addEventListener('click', clearFoodSelections);
          }

          if(toggleBtn && !toggleBtn.dataset.bound){
            toggleBtn.dataset.bound = '1';
            toggleBtn.addEventListener('click', () => setFoodPickerExpanded(!foodPickerExpanded));
          }
        }

        function initFoodPickerUI(){
          foodDraftSelection = getSavedFoodSelection();
          setFoodPickerExpanded(true);
          bindFoodPickerEvents();
          renderFoodPicker(document.getElementById('foodSearchInput')?.value || '');
          refreshFoodSummary();
        }

        setTimeout(() => {
          try{ initFoodPickerUI(); }catch(_e){}
        }, 0);

        function updateGreeting(){
          const userName = document.getElementById('userNameText')?.textContent || '';
          const rawProfileName = document.getElementById('name')?.value || '';
          const name = normalizeName((rawProfileName && rawProfileName.trim()) ? rawProfileName : ((userName && userName !== 'ØºÙŠØ± Ù…Ø³Ø¬Ù„') ? userName : ''));
          const welcome = document.getElementById('welcomeGreeting');
          const headerLine = document.getElementById('headerGreetingLine');
          if(welcome) welcome.textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${name}`;
          if(headerLine) headerLine.textContent = "";
        }

        function mirrorDietData(){
          const cal = document.getElementById('calOut')?.textContent?.trim() || 'â€”';
          const pro = document.getElementById('proOut')?.textContent?.trim() || 'â€”';
          const calNote = document.getElementById('calNote')?.textContent?.trim() || 'â€”';
          const proNote = document.getElementById('proNote')?.textContent?.trim() || 'â€”';
          const planHTML = document.getElementById('mealPlanOut')?.innerHTML || 'Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø¶ØºØ· "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†".';
          const logCount = document.getElementById('logCount')?.textContent?.trim() || '0 Ø³Ø·Ø±';
          const tdee = document.getElementById('tdeeOut')?.textContent?.trim() || 'â€”';

          const savedFoods = getSavedFoodSelection();

          const qDaily = document.getElementById('homeQuickDaily');
          const qDiet = document.getElementById('homeQuickDiet');
          const qWorkout = document.getElementById('homeQuickWorkout');
          if(qDaily) qDaily.textContent = (tdee && tdee !== 'â€”') ? `TDEE: ${tdee}` : 'Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†';
          if(qDiet) qDiet.textContent = savedFoods.length ? `${savedFoods.length} Ø£Ø·Ø¹Ù…Ø© Ù…Ø­ÙÙˆØ¸Ø©` : ((cal && cal !== 'â€”') ? `Ø§Ù„Ø³Ø¹Ø±Ø§Øª: ${cal}` : 'Ø³ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨');
          if(qWorkout) qWorkout.textContent = logCount;

          const m1 = document.getElementById('dietCalMirror');
          const m2 = document.getElementById('dietProMirror');
          const m3 = document.getElementById('dietCalNoteMirror');
          const m4 = document.getElementById('dietProNoteMirror');
          const m5 = document.getElementById('dietPlanMirror');
          const m6 = document.getElementById('dietChoicePlanMirror');
          const m7 = document.getElementById('foodPickSummary');
          if(m1) m1.textContent = cal;
          if(m2) m2.textContent = pro;
          if(m3) m3.textContent = calNote;
          if(m4) m4.textContent = proNote;
          if(m5) m5.innerHTML = planHTML;
          if(m6) m6.innerHTML = buildDietChoicePlanHTML(savedFoods);
          if(m7 && savedFoods.length){
            const selectedItems = savedFoods.map(id => FOOD_LIBRARY.find(item => item.id === id)).filter(Boolean);
            const names = selectedItems.slice(0, 6).map(item => `${item.name} (${item.kcal} Ø³ / ${item.protein} Ø¨Ø±ÙˆØªÙŠÙ†)`).join(' â€¢ ');
            const totalKcal = selectedItems.reduce((sum, item) => sum + (Number(item.kcal) || 0), 0);
            const totalProtein = Math.round(selectedItems.reduce((sum, item) => sum + (Number(item.protein) || 0), 0) * 10) / 10;
            m7.innerHTML = `<strong>${savedFoods.length} ØµÙ†ÙÙ‹Ø§ Ù…Ø­ÙÙˆØ¸Ù‹Ø§</strong><br><span class="muted">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: ${totalKcal} Ø³Ø¹Ø±Ø© â€¢ ${totalProtein} Ø¬Ù… Ø¨Ø±ÙˆØªÙŠÙ†</span><br><span class="muted">${names}${savedFoods.length > 6 ? ' â€¦' : ''}</span>`;
          }else if(m7){
            m7.innerHTML = '<strong>Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªÙŠØ§Ø±Ùƒ:</strong> Ø§Ø®ØªØ± Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ùƒ Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸ØŒ ÙˆØ³ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø§Ù‹ Ù„Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹.';
          }
        }

        // Observe app visibility (auth -> app)
        const appObserver = new MutationObserver(() => {
          if(!appMain.hidden) setMainMode();
        });
        appObserver.observe(appMain, { attributes:true, attributeFilter:['hidden'] });

        // Observe dynamic texts
        ['userNameText','name','calOut','proOut','calNote','proNote','mealPlanOut','logCount','tdeeOut'].forEach(id => {
          const el = document.getElementById(id);
          if(!el) return;
          if(el.tagName === 'INPUT') el.addEventListener('input', updateGreeting);
          const mo = new MutationObserver(() => { updateGreeting(); mirrorDietData(); });
          mo.observe(el, { childList:true, subtree:true, characterData:true });
        });

        // Also listen to common action buttons for delayed UI refresh
        ['calcBtn','saveBtn','addSetBtn','clearLogBtn','btnSaveAccount','btnLogin','btnRegister'].forEach(id => {
          const el = document.getElementById(id);
          if(el) el.addEventListener('click', () => setTimeout(() => { updateGreeting(); mirrorDietData(); }, 250));
        });

        // Initial state
        updateGreeting();
        try{ initFoodPickerUI(); }catch(err){ console.warn("Food picker init failed:", err); }
        try{ mirrorDietData(); }catch(err){ console.warn("Diet mirror failed:", err); }
        if(!appMain.hidden) setMainMode();
      });
    })();
  </script>

</body>
</html>
